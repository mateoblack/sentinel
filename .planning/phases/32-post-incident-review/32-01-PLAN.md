---
phase: 32-post-incident-review
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [cli/breakglass_list.go, cli/breakglass_list_test.go, cli/breakglass_check.go, cli/breakglass_check_test.go]
autonomous: true
---

<objective>
Implement CLI commands to list and check break-glass events for post-incident review.

Purpose: Enable security teams and invokers to view break-glass event history and details for audit and incident follow-up.
Output: `sentinel breakglass-list` and `sentinel breakglass-check` commands with JSON output.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries for break-glass context
@.planning/phases/27-break-glass-schema/27-01-SUMMARY.md
@.planning/phases/28-break-glass-command/28-01-SUMMARY.md

# Pattern references
@cli/sentinel_list.go
@cli/check.go
@breakglass/store.go
@breakglass/types.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create breakglass-list CLI command</name>
  <files>cli/breakglass_list.go, cli/breakglass_list_test.go</files>
  <action>
Create `sentinel breakglass-list` command following cli/sentinel_list.go pattern.

**Input struct (BreakGlassListCommandInput):**
- Invoker string (filter by invoker, default current user if no other filter)
- Status string (filter by status: active, closed, expired)
- Profile string (filter by AWS profile)
- Limit int (default 100, max 1000)
- BreakGlassTable string (required, DynamoDB table)
- Region string (optional AWS region)
- Store breakglass.Store (optional, for testing)

**Output struct (BreakGlassListCommandOutput):**
- Events []BreakGlassEventSummary

**BreakGlassEventSummary struct:**
- ID string `json:"id"`
- Profile string `json:"profile"`
- Status string `json:"status"`
- Invoker string `json:"invoker"`
- ReasonCode string `json:"reason_code"`
- CreatedAt time.Time `json:"created_at"`
- ExpiresAt time.Time `json:"expires_at"`

**Logic:**
1. If no filter specified, default to current user's events
2. Query priority: status > profile > invoker (same as sentinel_list.go)
3. Filter by invoker if specified AND query was not by invoker
4. Format as JSON array and output

**ConfigureBreakGlassListCommand:**
- Register as "breakglass-list" subcommand
- Flags: --invoker, --status, --profile, --limit, --breakglass-table (required), --region

**Tests (cli/breakglass_list_test.go):**
- Table-driven tests with mock Store
- Test cases: list by current user, list by invoker, list by status, list by profile, combined filters, empty results
  </action>
  <verify>go test ./cli/... -run TestBreakGlassList -v passes</verify>
  <done>breakglass-list command outputs JSON array of events with all filters working</done>
</task>

<task type="auto">
  <name>Task 2: Create breakglass-check CLI command</name>
  <files>cli/breakglass_check.go, cli/breakglass_check_test.go</files>
  <action>
Create `sentinel breakglass-check` command following cli/check.go pattern.

**Input struct (BreakGlassCheckCommandInput):**
- EventID string (required argument)
- BreakGlassTable string (required flag)
- Region string (optional)
- Store breakglass.Store (optional, for testing)

**Output struct (BreakGlassCheckCommandOutput):**
- ID string `json:"id"`
- Invoker string `json:"invoker"`
- Profile string `json:"profile"`
- ReasonCode string `json:"reason_code"`
- Justification string `json:"justification"`
- Duration string `json:"duration"` (formatted as "1h30m")
- Status string `json:"status"`
- CreatedAt time.Time `json:"created_at"`
- UpdatedAt time.Time `json:"updated_at"`
- ExpiresAt time.Time `json:"expires_at"`
- ClosedBy string `json:"closed_by,omitempty"`
- ClosedReason string `json:"closed_reason,omitempty"`
- RequestID string `json:"request_id,omitempty"`

**Logic:**
1. Validate event ID format using breakglass.ValidateBreakGlassID()
2. Create or use provided Store
3. Fetch event using store.Get()
4. Handle ErrEventNotFound
5. Format duration as human-readable string (reuse formatDuration from check.go)
6. Output JSON

**ConfigureBreakGlassCheckCommand:**
- Register as "breakglass-check" subcommand
- Arg: event-id (required)
- Flags: --breakglass-table (required), --region

**Tests (cli/breakglass_check_test.go):**
- Test cases: successful check, event not found, invalid ID format
- Use mock Store for testing
  </action>
  <verify>go test ./cli/... -run TestBreakGlassCheck -v passes</verify>
  <done>breakglass-check command outputs full event details as JSON</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/... -run "TestBreakGlass(List|Check)" -v` passes all tests
- [ ] Both commands registered and show in `sentinel --help`
- [ ] JSON output format matches specification
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- breakglass-list lists events with all filter combinations
- breakglass-check shows full event details
- Commands follow existing CLI patterns for consistency
</success_criteria>

<output>
After completion, create `.planning/phases/32-post-incident-review/32-01-SUMMARY.md`
</output>
