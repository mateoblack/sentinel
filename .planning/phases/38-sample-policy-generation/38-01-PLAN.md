---
phase: 38-sample-policy-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [bootstrap/generator.go, bootstrap/generator_test.go]
autonomous: true
---

<objective>
Create sample policy generator that produces safe, valid starter policy YAML for new profiles.

Purpose: When bootstrapping, generate sensible default policies that users can customize rather than starting from scratch. These policies pass validation and demonstrate the policy schema.
Output: GenerateSamplePolicy() function returning valid policy YAML strings for profiles.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@policy/types.go
@policy/validate.go
@bootstrap/types.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sample policy generator</name>
  <files>bootstrap/generator.go</files>
  <action>
Create GenerateSamplePolicy(profile, description string) (string, error) function that:

1. Builds a policy.Policy struct with:
   - Version: "1" (from bootstrap.PolicyVersion constant)
   - Rules slice with one default deny rule:
     - Name: "default-deny"
     - Effect: policy.EffectDeny
     - Conditions: profiles list containing the profile name
     - Reason: "Default deny - customize this policy"

2. Marshals to YAML using gopkg.in/yaml.v3 with 2-space indent

3. Prepends a comment header with:
   - Profile name
   - Description (if provided)
   - Generated timestamp
   - Note about customization

The generated YAML should look like:
```yaml
# Sentinel policy for profile: {profile}
# {description}
# Generated: {timestamp}
# Customize this policy to match your access requirements.

version: "1"
rules:
  - name: default-deny
    effect: deny
    conditions:
      profiles:
        - {profile}
    reason: "Default deny - customize this policy"
```

Validate the generated policy before returning (call policy.Policy.Validate()).
Return error if profile name is empty.
  </action>
  <verify>go build ./bootstrap/... succeeds</verify>
  <done>GenerateSamplePolicy function exists and compiles</done>
</task>

<task type="auto">
  <name>Task 2: Add comprehensive tests for generator</name>
  <files>bootstrap/generator_test.go</files>
  <action>
Create table-driven tests for GenerateSamplePolicy covering:

1. Valid profile - generates valid YAML that parses and validates
2. Valid profile with description - includes description in header
3. Empty profile name - returns error
4. Generated policy passes validation - roundtrip parse and validate
5. Output contains expected structure (version, rules, profile in conditions)

Test pattern:
- Generate policy with GenerateSamplePolicy
- Parse result with policy.ParsePolicy
- Validate result with policy.Validate()
- Check rule count, effect, profile in conditions

Use policy package imports for parsing/validation.
Follow existing test patterns from bootstrap/validate_test.go.
  </action>
  <verify>go test ./bootstrap/... -v -run TestGenerateSamplePolicy passes</verify>
  <done>All tests pass, generator produces valid policies</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] go build ./bootstrap/... succeeds
- [ ] go test ./bootstrap/... -v passes
- [ ] go vet ./bootstrap/... passes
- [ ] Generated policy YAML is valid and parseable
</verification>

<success_criteria>

- GenerateSamplePolicy function creates valid policy YAML
- Generated policies pass policy.Validate()
- Tests cover success and error cases
- Comment header includes profile and description
</success_criteria>

<output>
After completion, create `.planning/phases/38-sample-policy-generation/38-01-SUMMARY.md`
</output>
