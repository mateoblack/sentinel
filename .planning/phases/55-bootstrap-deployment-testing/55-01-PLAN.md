---
phase: 55-bootstrap-deployment-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bootstrap/planner_test.go
  - bootstrap/validate_test.go
  - bootstrap/generator_test.go
  - bootstrap/iam_test.go
autonomous: true
---

<objective>
Add security-focused edge case tests for bootstrap planner and validation functions.

Purpose: Increase coverage of bootstrap validation and generation code from ~95.7% to >98%, focusing on input validation edge cases and error paths.
Output: Comprehensive test coverage for validation functions, context handling, and format edge cases.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@bootstrap/planner.go
@bootstrap/validate.go
@bootstrap/generator.go
@bootstrap/iam.go
@bootstrap/planner_test.go
@bootstrap/validate_test.go
@testutil/mock_aws.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SSM path and profile name validation edge cases</name>
  <files>bootstrap/validate_test.go</files>
  <action>Add comprehensive edge case tests for isValidSSMPath and isValidProfileName:

**SSM Path tests:**
- Unicode characters (should reject)
- Zero-width characters (security: should reject)
- Path traversal attempts (../ sequences)
- Maximum length paths
- Empty path components (// in path)
- Paths starting without /
- Whitespace in paths

**Profile Name tests:**
- Unicode characters (should reject)
- Reserved AWS names (if any)
- Maximum length names
- Whitespace characters
- Special characters that look like alphanumeric (e.g., full-width letters)

Use table-driven tests with descriptive names. Pattern: `TestIsValidSSMPath_EdgeCases` and `TestIsValidProfileName_EdgeCases`.</action>
  <verify>go test -v ./bootstrap/... -run "EdgeCases" passes</verify>
  <done>All validation edge cases tested, isValidSSMPath and isValidProfileName at 100% coverage</done>
</task>

<task type="auto">
  <name>Task 2: Add context cancellation and error path tests</name>
  <files>bootstrap/planner_test.go</files>
  <action>Add tests for context handling and error scenarios:

**Context cancellation:**
- Create test that passes cancelled context to Plan()
- Verify error is returned appropriately (mock should propagate context error)

**Nil pointer handling:**
- Test Plan() with nil config (should return error)
- Test with config where Profiles is nil vs empty slice

**Parameter version edge cases:**
- Version = 0 (no version in response)
- Very high version numbers

Use testutil.MockSSMClient for consistent mock behavior.</action>
  <verify>go test -v ./bootstrap/... -run "Context|Nil" passes</verify>
  <done>Context cancellation and nil input handling tests added</done>
</task>

<task type="auto">
  <name>Task 3: Add generator and IAM format edge case tests</name>
  <files>bootstrap/generator_test.go, bootstrap/iam_test.go</files>
  <action>Add edge case tests for sample policy generation and IAM formatting:

**GenerateSamplePolicy tests:**
- Profile with empty RoleARN (should still generate)
- Profile with very long name (path length limits)
- Multiple profiles with same name (detect duplicates?)
- DefaultDuration = 0 (should use sensible default)

**FormatIAMPolicy tests:**
- Empty StatementSid
- Special characters in resource ARN that need escaping
- Verify JSON output is valid (unmarshal test)
- Multiple statements in policy

Check current coverage gaps in generator.go:15 (84.6%) and iam.go:78 (75.0%) and target those specific uncovered lines.</action>
  <verify>go test -v ./bootstrap/... -run "Generator|IAM" passes, go test -cover ./bootstrap/... shows >98%</verify>
  <done>Generator at >95% coverage, FormatIAMPolicy at >90% coverage, overall bootstrap >98%</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test -v ./bootstrap/...` passes all tests
- [ ] `go test -cover ./bootstrap/...` shows >98% coverage
- [ ] No race conditions: `go test -race ./bootstrap/...` passes
- [ ] All new tests use table-driven patterns with descriptive names
</verification>

<success_criteria>
- All tasks completed
- Bootstrap package coverage increased from 95.7% to >98%
- Validation functions (isValidSSMPath, isValidProfileName) at 100% coverage
- GenerateSamplePolicy and FormatIAMPolicy gaps addressed
- All new tests pass including race detector
</success_criteria>

<output>
After completion, create `.planning/phases/55-bootstrap-deployment-testing/55-01-SUMMARY.md`
</output>
