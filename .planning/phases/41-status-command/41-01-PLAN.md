---
phase: 41-status-command
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [bootstrap/status.go, bootstrap/status_test.go, cli/status.go, cli/status_test.go, cmd/sentinel/main.go]
autonomous: true
---

<objective>
Create `sentinel init status` command showing policy root, profiles with parameters, and versions.

Purpose: Enable users to view current Sentinel bootstrap state without making changes.
Output: Working status command with human-readable and JSON output formats.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-bootstrap-command/40-01-SUMMARY.md

# Relevant source files
@bootstrap/types.go
@bootstrap/planner.go
@cli/bootstrap.go
@cli/breakglass_list.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusChecker with GetParametersByPath SSM query</name>
  <files>bootstrap/status.go, bootstrap/status_test.go</files>
  <action>
Create a StatusChecker struct in bootstrap package:

1. Define ssmStatusAPI interface with GetParametersByPath method (separate from planner's ssmAPI - they have different method needs)

2. Create StatusChecker struct with ssmStatusAPI field

3. Create ParameterInfo struct to hold status results:
   - Name (string) - parameter name
   - Path (string) - full SSM path
   - Version (int64) - SSM version number
   - LastModified (time.Time) - when last modified
   - Type (string) - parameter type (String/SecureString)

4. Create StatusResult struct:
   - PolicyRoot (string) - the root path queried
   - Parameters ([]ParameterInfo) - found parameters
   - Count (int) - total count

5. Implement GetStatus(ctx, policyRoot string) (*StatusResult, error):
   - Use ssm.GetParametersByPath with Path=policyRoot, Recursive=false
   - Handle pagination via NextToken
   - Parse results into ParameterInfo structs
   - Extract profile name from parameter path (everything after policyRoot/)
   - Return StatusResult with populated fields

6. Create NewStatusChecker(cfg aws.Config) *StatusChecker constructor

7. Create newStatusCheckerWithClient(client ssmStatusAPI) for testing

Tests: Use mockSSMStatusAPI pattern (like bootstrap/planner_test.go):
- Test with empty results (no parameters)
- Test with single parameter
- Test with multiple parameters
- Test pagination handling (mock NextToken)
- Test SSM error handling
  </action>
  <verify>go test ./bootstrap/... -run TestStatusChecker -v passes</verify>
  <done>StatusChecker can query SSM parameters by path and return structured results</done>
</task>

<task type="auto">
  <name>Task 2: Create status CLI command with human and JSON output</name>
  <files>cli/status.go, cli/status_test.go, cmd/sentinel/main.go</files>
  <action>
Create `sentinel init status` CLI command:

1. In cli/status.go, create StatusCommandInput struct:
   - PolicyRoot (string) - SSM path prefix (default: /sentinel/policies)
   - Region (string) - AWS region (optional)
   - JSONOutput (bool) - output format flag
   - StatusChecker (*bootstrap.StatusChecker) - for testing

2. Create ConfigureStatusCommand(app, s) following bootstrap.go pattern:
   - Add as subcommand of "init" (use existing initCmd if possible, otherwise create)
   - Add --policy-root flag with default
   - Add --region flag
   - Add --json flag
   - Wire to StatusCommand function

3. Implement StatusCommand(ctx, input) error:
   - Get or create StatusChecker (interface injection for tests)
   - Load AWS config with optional region
   - Call GetStatus(ctx, policyRoot)
   - Format output based on JSONOutput flag

4. Human-readable output format:
```
Sentinel Policy Status
======================

Policy Root: /sentinel/policies

Profiles:
  production    v3  (last modified: 2026-01-15 14:30:00)
  staging       v1  (last modified: 2026-01-14 10:00:00)
  development   v5  (last modified: 2026-01-16 09:15:00)

Total: 3 policy parameters
```

5. JSON output format:
```json
{
  "policy_root": "/sentinel/policies",
  "parameters": [
    {"name": "production", "path": "/sentinel/policies/production", "version": 3, "last_modified": "..."},
    ...
  ],
  "count": 3
}
```

6. In cmd/sentinel/main.go, add ConfigureStatusCommand call

Tests (following cli/bootstrap_test.go pattern):
- Test with mock StatusChecker returning empty results
- Test with mock returning parameters
- Test human output format
- Test JSON output format
- Test region flag handling
  </action>
  <verify>go test ./cli/... -run TestStatusCommand -v passes && go build ./cmd/sentinel</verify>
  <done>sentinel init status command works with both human and JSON output formats</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] go test ./bootstrap/... passes
- [ ] go test ./cli/... passes
- [ ] go build ./cmd/sentinel succeeds
- [ ] sentinel init status --help shows expected flags
- [ ] No linting errors (go vet ./...)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- StatusChecker correctly queries SSM GetParametersByPath
- CLI command handles both human and JSON output
- Tests cover main scenarios including empty results and pagination
</success_criteria>

<output>
After completion, create `.planning/phases/41-status-command/41-01-SUMMARY.md`
</output>
