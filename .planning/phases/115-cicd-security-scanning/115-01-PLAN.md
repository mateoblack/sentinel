---
phase: 115-cicd-security-scanning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/goseccheck.yml
  - .github/workflows/trivy-scan.yml
autonomous: true
---

<objective>
Fix and enhance existing GitHub Actions security scanning workflows for SAST and dependency scanning.

Purpose: The existing gosec and trivy workflows have configuration issues (wrong branch names, outdated actions, broken Docker references) that prevent effective security scanning. This plan fixes these issues and aligns all security workflows with current best practices.

Output: Working security scanning workflows that run on PR/push to main, produce SARIF reports for GitHub Security tab integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing workflows to fix:
@.github/workflows/goseccheck.yml
@.github/workflows/trivey-scan.yml
@.github/workflows/govulncheck.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix and enhance gosec workflow</name>
  <files>.github/workflows/goseccheck.yml</files>
  <action>
Update the gosec workflow to fix issues and add SARIF reporting:

1. Change branch from `master` to `main` (matches repo default)
2. Update action from `securego/gosec@master` to `securego/gosec@v2.22.4` (pinned version)
3. Update checkout action to v4
4. Add SARIF output for GitHub Security tab integration
5. Add scheduled weekly run (consistent with govulncheck)
6. Update permissions for security-events write access
7. Use ubuntu-latest (consistent with existing workflow)

Key configuration:
- Triggers: push to main, PR to main, weekly schedule
- Output: SARIF format uploaded to GitHub Security tab
- Args: `./...` to scan all packages
- Exclude: none (scan everything for comprehensive coverage)
  </action>
  <verify>
Validate YAML syntax: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/goseccheck.yml'))"`
Check workflow references main branch, not master
Check action version is pinned (not @master)
  </verify>
  <done>
gosec workflow updated with:
- Branch references changed to `main`
- Action version pinned to v2.22.4
- SARIF output with GitHub Security tab upload
- Weekly scheduled run added
- Permissions for security-events
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace Trivy Docker workflow with filesystem scan</name>
  <files>.github/workflows/trivy-scan.yml</files>
  <action>
Replace the broken Trivy Docker workflow (references non-existent Dockerfile) with a filesystem-based scan for Go dependencies:

1. Delete old trivey-scan.yml (note typo in filename)
2. Create new trivy-scan.yml (correct spelling)
3. Configure for filesystem scan mode (not Docker image scan)
4. Scan for vulnerable Go dependencies in go.mod/go.sum
5. Add SARIF output for GitHub Security tab
6. Match triggers with other security workflows (push, PR, weekly)

Key configuration:
- scan-type: 'fs' (filesystem scan for dependencies)
- scan-ref: '.' (repository root)
- scanners: 'vuln' (vulnerability scanning)
- severity: 'CRITICAL,HIGH' (focus on important issues)
- format: 'sarif' with GitHub upload
- ignore-unfixed: true (don't fail on vulnerabilities without fixes)
  </action>
  <verify>
Validate YAML syntax: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/trivy-scan.yml'))"`
Verify old trivey-scan.yml is deleted
Verify scan-type is 'fs' not 'image'
  </verify>
  <done>
Trivy workflow replaced with filesystem scan:
- Correct filename (trivy-scan.yml not trivey-scan.yml)
- Scans Go dependencies (go.mod/go.sum) not Docker images
- SARIF output with GitHub Security tab upload
- Consistent triggers with other security workflows
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] goseccheck.yml validates as valid YAML
- [ ] trivy-scan.yml validates as valid YAML
- [ ] Old trivey-scan.yml is deleted
- [ ] All workflows reference `main` branch (not `master`)
- [ ] All action versions are pinned (not @master or @latest)
- [ ] All workflows have SARIF upload steps
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Security workflows are consistent in triggers and output format
- No broken references to non-existent files (Dockerfile)
</success_criteria>

<output>
After completion, create `.planning/phases/115-cicd-security-scanning/115-01-SUMMARY.md`
</output>
