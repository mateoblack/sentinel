---
phase: 156-tvm-only
plan: 02
type: execute
wave: 2
depends_on: ["156-01"]
files_modified: [docs/TVM_MIGRATION.md, docs/QUICK_START.md, README.md, CHANGELOG.md]
autonomous: true
---

<objective>
Document TVM-only operation and provide migration guide for users moving from classic mode.

Purpose: Users need clear guidance on why classic mode was removed and how to migrate.
Output: Migration guide, updated docs, changelog entry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/156-tvm-only/156-01-SUMMARY.md (if exists)
@README.md
@CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TVM Migration Guide</name>
  <files>docs/TVM_MIGRATION.md</files>
  <action>
Create a migration guide for users moving from classic mode to TVM:

# Migrating to TVM-Only Mode (v2.1)

## Why Classic Mode Was Removed

Sentinel v2.1 removes "classic mode" (direct credential injection) because:

1. **Client-side is fakeable**: Device posture checks on the client can be bypassed
2. **Credentials escape**: Once injected, credentials can be captured/cached/reused
3. **No per-request policy**: Classic mode evaluates policy once, not on every SDK call
4. **Server-side is verified**: Lambda TVM puts trust boundary in AWS infrastructure

## What Changed

| Before (v2.0) | After (v2.1) |
|---------------|--------------|
| `sentinel exec profile -- cmd` | `sentinel exec --remote-server <url> profile -- cmd` |
| `sentinel credentials --profile profile` | Removed |
| `sentinel exec --server profile -- cmd` | Removed |

## Migration Steps

### 1. Deploy Lambda TVM

```bash
# Deploy TVM infrastructure
sentinel tvm deploy --region us-east-1

# Note the API Gateway URL output
```

### 2. Update Your Commands

```bash
# Before
sentinel exec production -- aws s3 ls

# After
sentinel exec --remote-server https://abc123.execute-api.us-east-1.amazonaws.com production -- aws s3 ls
```

### 3. Update credential_process (if used)

If you used `sentinel credentials` in `~/.aws/config`:

```ini
# Before (no longer works)
[profile production]
credential_process = sentinel credentials --profile production

# After - use container credentials
[profile production]
# Configure your SDK to use container credentials from TVM
# See: docs/SDK_CONFIGURATION.md
```

### 4. Update CI/CD Pipelines

Replace direct credential injection with TVM calls.

## FAQ

**Q: Why can't I use classic mode?**
A: Classic mode is fakeable. Device posture and policy are client-side, meaning attackers can bypass them. TVM enforces security server-side.

**Q: Is TVM more complex?**
A: Initial setup requires deploying Lambda (~5 min with Terraform). After that, usage is identical.

**Q: What about latency?**
A: TVM adds ~50-100ms per credential refresh (every 15 min by default). For interactive use, imperceptible.

**Q: Can I still use SSO/IAM Identity Center?**
A: Yes. TVM supports SSO profiles. The Lambda assumes the role using your SSO session.
  </action>
  <verify>test -f docs/TVM_MIGRATION.md && wc -l docs/TVM_MIGRATION.md | awk '$1 > 50'</verify>
  <done>Migration guide exists with 50+ lines of content</done>
</task>

<task type="auto">
  <name>Task 2: Update README with TVM-only messaging</name>
  <files>README.md</files>
  <action>
Update README to reflect TVM-only operation:

1. Update quick start to show --remote-server as the primary usage
2. Add prominent note: "Sentinel v2.1+ requires Lambda TVM for verified security"
3. Remove references to credential_process and --server mode
4. Link to migration guide for users upgrading from v2.0

Key messaging:
- "The Lambda isn't overhead. It's where the intelligence lives."
- "No Lambda = no threat intel = just another fakeable CLI tool."
  </action>
  <verify>grep -i "remote-server" README.md</verify>
  <done>README reflects TVM-only operation</done>
</task>

<task type="auto">
  <name>Task 3: Update CHANGELOG</name>
  <files>CHANGELOG.md</files>
  <action>
Add v2.1.0 changelog entry:

## [2.1.0] - 2026-01-XX

### BREAKING CHANGES

- **Removed classic mode**: `sentinel exec` now requires `--remote-server <url>`
- **Removed credentials command**: `sentinel credentials` no longer exists
- **Removed --server flag**: Local metadata server mode removed

### Why

Client-side credential handling is fakeable. Server-side (TVM) is verified. We don't ship fakeable security.

### Migration

See [docs/TVM_MIGRATION.md](docs/TVM_MIGRATION.md) for upgrade guide.

### Security

- All credential vending now happens server-side through Lambda TVM
- Device posture verification is server-enforced
- Policy evaluation cannot be bypassed by clients
  </action>
  <verify>grep -i "2.1.0" CHANGELOG.md</verify>
  <done>CHANGELOG has v2.1.0 entry</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docs/TVM_MIGRATION.md exists
- [ ] README.md updated with TVM-only messaging
- [ ] CHANGELOG.md has v2.1.0 entry
- [ ] All changes committed
</verification>

<success_criteria>
- Migration guide provides clear upgrade path
- README reflects new security posture
- CHANGELOG documents breaking changes
</success_criteria>

<output>
After completion, create `.planning/phases/156-tvm-only/156-02-SUMMARY.md`
</output>
