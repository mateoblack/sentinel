---
phase: 78.1-sso-credential-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [cli/whoami_test.go]
autonomous: true
---

<objective>
Add comprehensive test coverage for whoami command SSO credential loading via --profile flag.

Purpose: Verify the --profile flag correctly flows to WithSharedConfigProfile for SSO credential loading.
Output: Enhanced test coverage for whoami SSO profile credential loading pattern.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/77-whoami-profile-flag/77-01-SUMMARY.md

@cli/whoami.go
@cli/whoami_test.go
@cli/credentials_test.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add comprehensive SSO profile tests for whoami command</name>
  <files>cli/whoami_test.go</files>
  <action>Add TestWhoamiCommand_UsesProfileForAWSConfig test function following the pattern in credentials_test.go:1201-1290. The existing TestWhoamiCommand_ProfileFlag only verifies the command works when STSClient is provided (bypassing profile loading). Add new tests to verify:
  1. Profile field exists in WhoamiCommandInput struct
  2. SSO profile configuration is recognized when AWS_CONFIG_FILE points to SSO config
  3. Profile value is accepted for SSO credential loading pattern
  Import filepath and vault packages if not already imported.</action>
  <verify>go test -v -run TestWhoamiCommand_UsesProfileForAWSConfig ./cli/ passes</verify>
  <done>TestWhoamiCommand_UsesProfileForAWSConfig test exists and passes</done>
</task>

<task type="auto">
  <name>Task 2: Add SSO profile configuration validation test</name>
  <files>cli/whoami_test.go</files>
  <action>Add sub-tests to verify SSO profile handling following the three sub-test pattern from sentinel_exec_test.go:630-721:
  1. "profile name is used in config" - create temp SSO config, verify profile can be loaded
  2. "SSO profile is recognized" - verify vault.LoadConfig sees SSO settings (SSOStartURL, SSORegion, SSOAccountID, SSORoleName)
  3. "input accepts SSO profile for credential loading" - verify WhoamiCommandInput accepts SSO profile name in Profile field</action>
  <verify>go test -v -run TestWhoamiCommand_UsesProfileForAWSConfig ./cli/ passes all sub-tests</verify>
  <done>All whoami SSO profile tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] go test -v -run TestWhoamiCommand_UsesProfileForAWSConfig ./cli/ passes
- [ ] Tests follow pattern from credentials_test.go and sentinel_exec_test.go
- [ ] All imports are correct (filepath, os, vault)
</verification>

<success_criteria>

- TestWhoamiCommand_UsesProfileForAWSConfig function exists
- Tests verify Profile field acceptance
- Tests verify SSO profile configuration recognition
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/78.1-sso-credential-fixes/78.1-02-SUMMARY.md`
</output>
