---
phase: 94-require-server-session
plan: 03
type: execute
wave: 2
depends_on: ["94-01"]
files_modified: [docs/guide/policy-reference.md, docs/CHANGELOG.md]
autonomous: true
---

<objective>
Document the require_server_session policy effect for users.

Purpose: Users understand how to enforce session tracking via policy.
Output: Updated policy reference documentation and changelog.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/94-require-server-session/94-01-SUMMARY.md

@docs/guide/policy-reference.md
@docs/CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document require_server_session effect in policy reference</name>
  <files>docs/guide/policy-reference.md</files>
  <action>
Add documentation for `require_server_session` effect after the existing `require_server` section:

```markdown
### require_server_session

The `require_server_session` effect allows access only when credentials are issued via server mode with session tracking enabled. This is the strictest enforcement mode, ensuring all credentials are both policy-evaluated per-request AND tracked for revocation.

```yaml
policies:
  - name: prod-requires-tracked-sessions
    match:
      profile: prod-*
    effect: require_server_session
    session_table: sentinel-sessions  # Optional: specify table (otherwise uses --session-table flag)
```

**Behavior:**
- If `--server` flag AND `--session-table` flag are provided: access allowed (credentials issued)
- If `--server` flag without `--session-table`: denied with "Policy requires session tracking"
- If neither `--server` nor `--session-table`: denied with "Policy requires server mode with session tracking"
- `credential_process` mode always denied (doesn't support sessions)

**session_table field:**
The optional `session_table` field in the policy specifies which DynamoDB table to use for session tracking. If not specified in the policy, the CLI flag `--session-table` must be provided.

**Use case:**
Enforce that all production access is:
1. Per-request policy evaluated (server mode)
2. Trackable in DynamoDB (for revocation and audit)
3. Visible in `sentinel server-sessions` output
```

Also add `session_table` to the Rule fields documentation table.
  </action>
  <verify>Cat the modified section to verify formatting</verify>
  <done>Policy reference documents require_server_session effect completely</done>
</task>

<task type="auto">
  <name>Task 2: Add changelog entry for require_server_session</name>
  <files>docs/CHANGELOG.md</files>
  <action>
Add a new section for v1.13.0 (or append to existing unreleased section) with:

```markdown
## [1.13.0] - Unreleased

### Added

- New `require_server_session` policy effect enforcing server mode with session tracking
- `session_table` field in policy rules for specifying session tracking table
- Actionable error messages guiding users from credential_process to exec --server --session-table

### Changed

- Policy evaluation now checks session table presence for require_server_session effect
```

Place this after the most recent version entry.
  </action>
  <verify>Cat docs/CHANGELOG.md | head -50 to verify formatting</verify>
  <done>Changelog documents new require_server_session feature</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] require_server_session effect documented in policy-reference.md
- [ ] session_table field documented
- [ ] Usage examples provided
- [ ] Changelog entry added
</verification>

<success_criteria>
- All tasks completed
- Documentation is clear and actionable
- Examples show real-world usage patterns
</success_criteria>

<output>
After completion, create `.planning/phases/94-require-server-session/94-03-SUMMARY.md`
</output>
