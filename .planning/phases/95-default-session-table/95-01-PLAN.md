---
phase: 95-default-session-table
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [cli/sentinel_exec.go, cli/sentinel_exec_test.go, cli/credentials.go]
autonomous: true
---

<objective>
Add global session table configuration via environment variable so users don't need `--session-table` flag every time.

Purpose: Reduce CLI verbosity for teams that always want session tracking enabled in server mode.
Output: SENTINEL_SESSION_TABLE env var support with CLI flag override.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/94-require-server-session/94-02-SUMMARY.md

@cli/sentinel_exec.go
@cli/credentials.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SENTINEL_SESSION_TABLE environment variable support to exec command</name>
  <files>cli/sentinel_exec.go</files>
  <action>
  Add environment variable lookup for SENTINEL_SESSION_TABLE before policy evaluation.

  Implementation:
  1. Add constant: `const EnvSessionTable = "SENTINEL_SESSION_TABLE"`
  2. In SentinelExecCommand, after validating server mode flag combinations (~line 150), add:
     - If input.SessionTableName is empty AND input.StartServer is true, check os.Getenv(EnvSessionTable)
     - If env var is set, use its value as the session table name
  3. Log when using env var: `log.Printf("Using session table from %s: %s", EnvSessionTable, tableName)`

  Precedence order (already correct from CLI behavior):
  1. --session-table CLI flag (explicit, highest priority)
  2. SENTINEL_SESSION_TABLE env var (fallback for server mode)
  3. Empty (no session tracking)

  Note: Only apply env var in server mode (--server flag). Non-server mode doesn't support session tracking.
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>SENTINEL_SESSION_TABLE env var read when --session-table not provided and --server is set</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for SENTINEL_SESSION_TABLE environment variable</name>
  <files>cli/sentinel_exec_test.go</files>
  <action>
  Add test cases for env var behavior in sentinel_exec_test.go.

  Test cases to add (use t.Setenv for env manipulation):

  1. TestSentinelExec_SessionTableEnvVar_ServerMode:
     - Set SENTINEL_SESSION_TABLE="sentinel-sessions"
     - Verify env var value is used when --session-table not provided and --server is set
     - Use field inspection (no actual command execution needed)

  2. TestSentinelExec_SessionTableCLIOverridesEnv:
     - Set SENTINEL_SESSION_TABLE="env-table"
     - Set input.SessionTableName="cli-table"
     - Verify CLI flag takes precedence over env var

  3. TestSentinelExec_SessionTableEnvIgnoredWithoutServer:
     - Set SENTINEL_SESSION_TABLE="sentinel-sessions"
     - Verify env var is NOT used when --server is not set (non-server mode)

  Follow existing test patterns in file (field inspection tests around line 1213).
  </action>
  <verify>go test ./cli/... -run TestSentinelExec_SessionTable -v passes</verify>
  <done>Tests verify env var precedence: CLI flag > env var > empty, and env var only applies in server mode</done>
</task>

<task type="auto">
  <name>Task 3: Document SENTINEL_SESSION_TABLE in init sessions output</name>
  <files>cli/init_sessions.go</files>
  <action>
  Update the "Next steps" section in InitSessionsCommand (around line 218) to improve documentation.

  Current output says:
  ```
  Next steps:
    1. Configure --session-table sentinel-sessions in sentinel exec --server
    2. Or set SENTINEL_SESSION_TABLE environment variable
  ```

  This is already correct but update to be more explicit:
  ```
  Next steps:
    1. Set SENTINEL_SESSION_TABLE=%s environment variable for automatic session tracking
    2. Or use --session-table %s explicitly with sentinel exec --server
  ```

  Use input.TableName in the format strings.
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>init sessions output clearly shows env var as primary option with table name</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] go build ./... succeeds without errors
- [ ] go test ./cli/... -run TestSentinelExec_SessionTable -v passes
- [ ] go vet ./... reports no issues
</verification>

<success_criteria>
- All tasks completed
- SENTINEL_SESSION_TABLE environment variable read in server mode
- CLI flag takes precedence over env var
- Env var ignored in non-server mode
- Tests cover all precedence scenarios
</success_criteria>

<output>
After completion, create `.planning/phases/95-default-session-table/95-01-SUMMARY.md`
</output>
