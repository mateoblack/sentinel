---
phase: 21-list-check-commands
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified: [cli/check.go, cli/check_test.go, cmd/sentinel/main.go]
autonomous: true
---

<objective>
Create `sentinel check` command to view status of a specific request by ID.

Purpose: Allow users to check the current status and details of their submitted requests.
Output: Working check command with detailed JSON output, request ID validation, and comprehensive test coverage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context - list command pattern
@.planning/phases/21-list-check-commands/21-01-SUMMARY.md

# Source files for patterns
@cli/request.go
@cli/request_test.go
@request/store.go
@request/types.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create check command with CLI configuration and core logic</name>
  <files>cli/check.go</files>
  <action>
Create check command following the request command pattern:

1. Define CheckCommandInput struct with fields:
   - RequestID string (required, the request to check)
   - RequestTable string (DynamoDB table name)
   - Region string (AWS region)
   - Store request.Store (optional, for testing)

2. Define CheckCommandOutput struct for detailed JSON output:
   - ID string
   - Requester string
   - Profile string
   - Justification string
   - Duration string (formatted as "1h30m")
   - Status string
   - CreatedAt time.Time
   - UpdatedAt time.Time
   - ExpiresAt time.Time
   - Approver string (omitempty)
   - ApproverComment string (omitempty)

3. Implement ConfigureCheckCommand(app *kingpin.Application, s *Sentinel):
   - Register "check" command with description "Check status of an access request"
   - Positional argument for request ID (required)
   - --request-table flag (required)
   - --region flag (optional)

4. Implement CheckCommand(ctx context.Context, input CheckCommandInput) error:
   - Validate request ID format using request.ValidateRequestID
   - Create DynamoDB store if Store is nil
   - Call store.Get(ctx, requestID)
   - Handle ErrRequestNotFound with user-friendly error message
   - Format result as JSON and output to stdout

Use fmt.Fprintf(os.Stderr, ...) for errors, fmt.Println for JSON output.
Format Duration as string like "1h" or "2h30m" for readability.
  </action>
  <verify>go build ./... succeeds</verify>
  <done>cli/check.go exists with ConfigureCheckCommand and CheckCommand functions</done>
</task>

<task type="auto">
  <name>Task 2: Wire command in main.go and add unit tests</name>
  <files>cmd/sentinel/main.go, cli/check_test.go</files>
  <action>
1. In cmd/sentinel/main.go:
   - Add cli.ConfigureCheckCommand(app, &sentinel) after ConfigureListCommand

2. In cli/check_test.go, create comprehensive test suite:
   - Reuse mockStore from request_test.go (it already has Get method)
   - Create testableCheckCommand helper (following request_test.go pattern)

Test cases (minimum 5):
- TestCheckCommand_Success: Valid request ID → returns full request details as JSON
- TestCheckCommand_NotFound: Request ID doesn't exist → returns "request not found" error
- TestCheckCommand_InvalidID: Malformed request ID → returns "invalid request ID" error
- TestCheckCommand_StoreError: Store returns unexpected error → command returns error
- TestCheckCommand_OutputFormat: Verify JSON includes all fields (ID, Profile, Status, Duration, etc.)

Verify Duration field is formatted as human-readable string (e.g., "1h30m" not nanoseconds).
  </action>
  <verify>go test ./cli/... -run TestCheck -v passes all tests</verify>
  <done>Check command wired in main.go, all 5+ tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/... -run TestCheck -v` passes all tests
- [ ] `go vet ./...` reports no issues
- [ ] `sentinel check --help` shows expected usage
</verification>

<success_criteria>

- CheckCommandInput and CheckCommandOutput structs defined
- ConfigureCheckCommand registers command with positional request ID argument
- CheckCommand validates ID, fetches request, outputs JSON
- Request not found handled with clear error message
- Invalid request ID format rejected before store call
- Duration formatted as human-readable string
</success_criteria>

<output>
After completion, create `.planning/phases/21-list-check-commands/21-02-SUMMARY.md`
</output>
