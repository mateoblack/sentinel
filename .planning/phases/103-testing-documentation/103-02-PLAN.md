---
phase: 103-testing-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [docs/LAMBDA_TVM_MIGRATION.md, docs/CHANGELOG.md]
autonomous: true
---

<objective>
Create migration guide comparing CLI server mode vs Lambda TVM, and update CHANGELOG.

Purpose: Help users choose between deployment models and complete v1.14 milestone documentation.
Output: Migration decision guide + CHANGELOG entry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing TVM documentation
@docs/LAMBDA_TVM_DEPLOYMENT.md
@docs/LAMBDA_TVM_COSTS.md
@docs/LAMBDA_TVM_SCP.md

# CLI server mode docs
@docs/QUICKSTART.md

# Current CHANGELOG
@docs/CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration guide - CLI server vs Lambda TVM</name>
  <files>docs/LAMBDA_TVM_MIGRATION.md</files>
  <action>
Create a decision framework document comparing CLI server mode (`sentinel exec --server`) vs Lambda TVM deployment:

**1. Overview**
- CLI server mode: Local metadata server, per-developer deployment
- Lambda TVM: Centralized server-side enforcement, organizational deployment

**2. Decision Matrix Table**

| Factor | CLI Server Mode | Lambda TVM |
|--------|----------------|------------|
| Trust boundary | Client-side | Server-side |
| Bypass prevention | Relies on client behavior | Enforced via IAM + SCP |
| Deployment | Per-developer workstation | Centralized AWS infrastructure |
| Session revocation | Local server restart | Instant via DynamoDB |
| Latency | ~10ms (local) | ~100-200ms (network) |
| Cost | None (local compute) | Lambda + API Gateway charges |
| Scaling | Single user | Organizational scale |
| Audit trail | Local logs | CloudWatch Logs |

**3. When to Use CLI Server Mode**
- Individual developers testing locally
- Development environments where bypass prevention isn't critical
- Scenarios requiring very low latency
- Teams not ready for AWS infrastructure deployment

**4. When to Use Lambda TVM**
- Production environments requiring enforcement
- Organizational deployment with bypass prevention
- When SCP enforcement is needed
- Compliance requirements for audit trails
- Multi-team/multi-account environments

**5. Migration Path: CLI to Lambda TVM**
Step-by-step guide:
1. Deploy Lambda TVM infrastructure (Terraform or CDK)
2. Configure protected roles to trust only Lambda execution role
3. Update client IAM policies to allow execute-api:Invoke
4. Deploy SCPs to block direct AssumeRole
5. Switch clients from `--server` to `--remote-server`

**6. Gradual Rollout Strategy**
- Phase 1: Deploy TVM alongside existing access
- Phase 2: Enable audit-only SCP (log but don't block)
- Phase 3: Enable blocking SCP for test roles
- Phase 4: Full enforcement

**7. Rollback Plan**
- How to disable SCPs
- How to re-enable direct AssumeRole
- When rollback is appropriate

Reference existing docs where applicable.
  </action>
  <verify>cat docs/LAMBDA_TVM_MIGRATION.md | head -80</verify>
  <done>Migration guide exists with decision matrix, use case guidance, and step-by-step migration path.</done>
</task>

<task type="auto">
  <name>Task 2: Update CHANGELOG with Phase 103</name>
  <files>docs/CHANGELOG.md</files>
  <action>
Add Phase 103 entry to CHANGELOG.md under the v1.14 section.

Entry should include:
- Phase 103: Testing & Documentation
- Security regression tests for TVM bypass prevention
- End-to-end testing documentation (LAMBDA_TVM_TESTING.md)
- Migration guide for CLI server vs Lambda TVM (LAMBDA_TVM_MIGRATION.md)
- Complete v1.14 milestone documentation

Also update milestone summary to mark v1.14 as complete (if this is the final phase).

Follow existing CHANGELOG format in the file.
  </action>
  <verify>grep -A 20 "Phase 103" docs/CHANGELOG.md</verify>
  <done>CHANGELOG updated with Phase 103 entry and v1.14 milestone marked complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docs/LAMBDA_TVM_MIGRATION.md exists with decision matrix and migration steps
- [ ] docs/CHANGELOG.md includes Phase 103 entry
- [ ] No errors in document formatting
</verification>

<success_criteria>

- Migration guide provides clear decision framework between deployment models
- CHANGELOG documents Phase 103 and completes v1.14 milestone
- Documentation is actionable and references existing resources
</success_criteria>

<output>
After completion, create `.planning/phases/103-testing-documentation/103-02-SUMMARY.md`
</output>
