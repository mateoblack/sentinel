---
phase: 26-approval-audit-trail
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [logging/approval.go, logging/approval_test.go, logging/logger.go, logging/logger_test.go]
autonomous: true
---

<objective>
Create approval audit trail logging infrastructure for request lifecycle events.

Purpose: Enable structured JSON logging of approval workflow events (request created, approved, denied, expired, cancelled) parallel to the existing decision logging, providing audit trail for compliance and debugging.

Output: ApprovalLogEntry type, extended Logger interface, comprehensive tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-approval-policies/25-03-SUMMARY.md

@logging/decision.go
@logging/logger.go
@notification/types.go
@request/types.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ApprovalLogEntry type</name>
  <files>logging/approval.go, logging/approval_test.go</files>
  <action>
Create new file logging/approval.go with ApprovalLogEntry struct capturing approval workflow events:

```go
type ApprovalLogEntry struct {
    Timestamp       string `json:"timestamp"`                       // ISO8601 format
    Event           string `json:"event"`                           // "request.created", "request.approved", etc.
    RequestID       string `json:"request_id"`                      // 16-char hex request ID
    Requester       string `json:"requester"`                       // Who requested access
    Profile         string `json:"profile"`                         // AWS profile requested
    Status          string `json:"status"`                          // Current status after event
    Actor           string `json:"actor"`                           // Who triggered event (requester, approver, or "system")
    Justification   string `json:"justification,omitempty"`         // Reason for request (on create)
    Duration        int    `json:"duration_seconds,omitempty"`      // Requested duration (on create)
    Approver        string `json:"approver,omitempty"`              // Who approved/denied
    ApproverComment string `json:"approver_comment,omitempty"`      // Comment from approver
    AutoApproved    bool   `json:"auto_approved,omitempty"`         // True if auto-approved by policy
}
```

Add constructor NewApprovalLogEntry(event EventType, req *Request, actor string) that:
- Sets Timestamp from iso8601.Format(time.Now())
- Copies event, request_id, requester, profile, status from inputs
- Sets actor
- Populates optional fields based on event type:
  - request.created: justification, duration
  - request.approved/denied: approver, approver_comment, auto_approved (if actor == requester)

Add tests verifying:
- All fields populated correctly for each event type
- JSON marshaling with omitempty behavior
- Constructor produces valid entries
  </action>
  <verify>go test ./logging/... -run TestApproval -v</verify>
  <done>ApprovalLogEntry type and constructor exist with full test coverage for all 5 event types</done>
</task>

<task type="auto">
  <name>Task 2: Extend Logger interface for approval events</name>
  <files>logging/logger.go, logging/logger_test.go</files>
  <action>
Extend the Logger interface to support approval logging:

```go
type Logger interface {
    LogDecision(entry DecisionLogEntry)
    LogApproval(entry ApprovalLogEntry)
}
```

Update JSONLogger to implement LogApproval - same pattern as LogDecision (JSON marshal, write line).

Update NopLogger to implement LogApproval - empty method.

Add tests for:
- JSONLogger.LogApproval writes valid JSON line
- NopLogger.LogApproval doesn't panic
- Multiple LogApproval calls produce separate lines
  </action>
  <verify>go test ./logging/... -v</verify>
  <done>Logger interface extended, JSONLogger and NopLogger both implement LogApproval</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./logging/...` passes all tests
- [ ] New ApprovalLogEntry captures all event types
- [ ] JSON output includes all fields with proper omitempty
</verification>

<success_criteria>
- ApprovalLogEntry type defined with all approval workflow fields
- NewApprovalLogEntry constructor handles all 5 event types
- Logger interface extended with LogApproval method
- JSONLogger and NopLogger implement new method
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/26-approval-audit-trail/26-01-SUMMARY.md`
</output>
