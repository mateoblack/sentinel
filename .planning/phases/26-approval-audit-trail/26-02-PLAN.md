---
phase: 26-approval-audit-trail
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified: [cli/request.go, cli/approve.go, cli/deny.go, cli/request_test.go, cli/approve_test.go, cli/deny_test.go]
autonomous: true
---

<objective>
Wire approval logging into CLI commands for request lifecycle events.

Purpose: Integrate ApprovalLogEntry logging into request, approve, and deny commands so that all approval workflow operations produce audit log entries alongside existing notification events.

Output: CLI commands emit approval log entries on state changes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-approval-audit-trail/26-01-SUMMARY.md

@cli/request.go
@cli/approve.go
@cli/deny.go
@logging/approval.go
@logging/logger.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add approval logging to request command</name>
  <files>cli/request.go, cli/request_test.go</files>
  <action>
Add Logger field to RequestCommandInput struct (same pattern as existing Notifier field):

```go
type RequestCommandInput struct {
    // ... existing fields ...
    Logger  logging.Logger  // Optional logger for audit trail
}
```

In the request command execution, after successfully creating/auto-approving a request:
1. If Logger is non-nil, create ApprovalLogEntry with EventRequestCreated
2. If auto-approved, also log EventRequestApproved with AutoApproved=true
3. Call Logger.LogApproval(entry)

Add tests:
- Request with Logger logs EventRequestCreated
- Auto-approved request logs both EventRequestCreated and EventRequestApproved
- Request without Logger works (nil check)
  </action>
  <verify>go test ./cli/... -run TestRequestCommand -v</verify>
  <done>Request command logs approval events when Logger provided</done>
</task>

<task type="auto">
  <name>Task 2: Add approval logging to approve/deny commands</name>
  <files>cli/approve.go, cli/deny.go, cli/approve_test.go, cli/deny_test.go</files>
  <action>
Add Logger field to ApproveCommandInput and DenyCommandInput structs:

```go
type ApproveCommandInput struct {
    // ... existing fields ...
    Logger  logging.Logger
}

type DenyCommandInput struct {
    // ... existing fields ...
    Logger  logging.Logger
}
```

In approve command, after successful approval:
- Log EventRequestApproved with approver and comment

In deny command, after successful denial:
- Log EventRequestDenied with approver and comment

Add tests:
- Approve with Logger logs EventRequestApproved
- Deny with Logger logs EventRequestDenied
- Both commands work without Logger (nil check)
  </action>
  <verify>go test ./cli/... -run "TestApprove|TestDeny" -v</verify>
  <done>Approve and deny commands log approval events when Logger provided</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/...` passes all tests
- [ ] Request command logs on create and auto-approve
- [ ] Approve command logs on approval
- [ ] Deny command logs on denial
</verification>

<success_criteria>
- All three CLI commands accept optional Logger
- Events logged for: request.created, request.approved (manual and auto), request.denied
- Nil Logger causes no panic (backward compatible)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/26-approval-audit-trail/26-02-SUMMARY.md`
</output>
