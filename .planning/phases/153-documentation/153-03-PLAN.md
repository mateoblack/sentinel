---
phase: 153-documentation
plan: 03
type: execute
wave: 2
depends_on: ["153-02"]
files_modified: [cli/credentials_test.go, cli/policy_test.go, cli/shell_init_test.go, cli/whoami_test.go]
autonomous: true
---

<objective>
Add Example* tests for documented CLI commands.

Purpose: Ensure documented code examples are tested and remain accurate across releases.
Output: Example* tests covering major CLI workflows documented in README and QUICKSTART.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@cli/credentials_test.go
@cli/policy_test.go
@cli/shell_init_test.go
@cli/whoami_test.go
@cli/exec_test.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Example tests for sentinel credentials command</name>
  <files>cli/credentials_test.go</files>
  <action>
Add Example* test functions that document CLI usage patterns:

```go
func ExampleCredentialsCommand() {
	// sentinel credentials --profile dev --policy-parameter /sentinel/policies/dev
	// Returns JSON credentials for use with credential_process in ~/.aws/config
	// Output format:
	// {
	//   "Version": 1,
	//   "AccessKeyId": "ASIA...",
	//   "SecretAccessKey": "...",
	//   "SessionToken": "...",
	//   "Expiration": "2026-01-27T12:00:00Z"
	// }
	fmt.Println("See docs/QUICKSTART.md for credential_process configuration")
	// Output: See docs/QUICKSTART.md for credential_process configuration
}
```

This test documents the expected output format and references to documentation.
The Example test pattern in Go generates documentation from test output.
  </action>
  <verify>grep -c "func Example" cli/credentials_test.go</verify>
  <done>credentials_test.go has Example* test documenting command usage</done>
</task>

<task type="auto">
  <name>Task 2: Add Example tests for policy commands</name>
  <files>cli/policy_test.go</files>
  <action>
Add Example* tests for the policy subcommands documented in README:

```go
func ExamplePolicyValidateCommand() {
	// sentinel policy validate policy.yaml
	// Validates policy YAML locally without AWS credentials
	// Returns exit code 0 if valid, non-zero if invalid
	fmt.Println("Policy validation checks: schema version, rule syntax, time window format")
	// Output: Policy validation checks: schema version, rule syntax, time window format
}

func ExamplePolicyDiffCommand() {
	// sentinel policy diff prod /path/to/local-policy.yaml
	// Shows unified diff between SSM policy and local file
	// Exit code: 0 = no changes, 1 = changes detected
	fmt.Println("Diff output uses unified format with color (--no-color to disable)")
	// Output: Diff output uses unified format with color (--no-color to disable)
}
```

Example tests serve as executable documentation and verify output format expectations.
  </action>
  <verify>grep -c "func Example" cli/policy_test.go</verify>
  <done>policy_test.go has Example* tests for validate and diff commands</done>
</task>

<task type="auto">
  <name>Task 3: Add Example tests for shell and whoami commands</name>
  <files>cli/shell_init_test.go, cli/whoami_test.go</files>
  <action>
Add Example* tests for shell init and whoami commands:

In cli/shell_init_test.go:
```go
func ExampleShellInitCommand() {
	// sentinel shell init
	// Outputs shell functions to source in ~/.bashrc or ~/.zshrc
	// Generated functions: sentinel-{profile} for each profile found in SSM
	// Usage: eval "$(sentinel shell init)"
	fmt.Println("Shell integration provides sentinel-{profile} wrapper functions")
	// Output: Shell integration provides sentinel-{profile} wrapper functions
}
```

In cli/whoami_test.go:
```go
func ExampleWhoamiCommand() {
	// sentinel whoami
	// Shows your AWS identity and how Sentinel sees it for policy evaluation
	// Useful for debugging policy matching issues
	fmt.Println("Identity: IAM ARN, Policy Username, Account ID")
	// Output: Identity: IAM ARN, Policy Username, Account ID
}
```

These Example tests document the primary use cases shown in documentation.
  </action>
  <verify>grep -c "func Example" cli/shell_init_test.go cli/whoami_test.go</verify>
  <done>shell_init_test.go and whoami_test.go have Example* tests</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] cli/credentials_test.go has Example* test
- [ ] cli/policy_test.go has Example* tests (2+)
- [ ] cli/shell_init_test.go has Example* test
- [ ] cli/whoami_test.go has Example* test
- [ ] go test -run Example ./cli/... passes
</verification>

<success_criteria>

- All tasks completed
- At least 6 new Example* tests added across 4 files
- All Example tests pass
- Tests document commands shown in README/QUICKSTART
</success_criteria>

<output>
After completion, create `.planning/phases/153-documentation/153-03-SUMMARY.md`
</output>
