---
phase: 89-breakglass-table-provisioning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [infrastructure/schema.go, infrastructure/schema_test.go]
autonomous: true
---

<objective>
Add BreakGlassTableSchema function to infrastructure package for break-glass DynamoDB table provisioning.

Purpose: Enable programmatic creation of the sentinel-breakglass table with correct schema matching breakglass/dynamodb.go.
Output: BreakGlassTableSchema() function with matching GSI structure and comprehensive tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/88-approval-table-provisioning/88-01-SUMMARY.md

@infrastructure/schema.go
@breakglass/dynamodb.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BreakGlassTableSchema function to infrastructure/schema.go</name>
  <files>infrastructure/schema.go</files>
  <action>
Add BreakGlassTableSchema(tableName string) function following the exact pattern of ApprovalTableSchema.

Schema must match breakglass/dynamodb.go (lines 40-44):
- Table name: parameter (default "sentinel-breakglass")
- Partition key: id (S)
- GSIs:
  - gsi-invoker: PK=invoker (S), SK=created_at (S), Projection=ALL
  - gsi-status: PK=status (S), SK=created_at (S), Projection=ALL
  - gsi-profile: PK=profile (S), SK=created_at (S), Projection=ALL
- TTL attribute: ttl
- Billing mode: PAY_PER_REQUEST

The ONLY difference from ApprovalTableSchema is the first GSI uses "invoker" instead of "requester".
  </action>
  <verify>go build ./infrastructure/... compiles without errors</verify>
  <done>BreakGlassTableSchema function exists and returns correct schema</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for BreakGlassTableSchema function</name>
  <files>infrastructure/schema_test.go</files>
  <action>
Add tests following the exact pattern of TestApprovalTableSchema:
- TestBreakGlassTableSchema: Verify returned schema has correct:
  - TableName matches input
  - PartitionKey is {Name: "id", Type: KeyTypeString}
  - Has exactly 3 GSIs
  - GSI names are gsi-invoker, gsi-status, gsi-profile
  - Each GSI has correct partition key (invoker, status, profile) and sort key (created_at)
  - TTLAttribute is "ttl"
  - BillingMode is BillingModePayPerRequest
  - Validate() returns nil
  </action>
  <verify>go test ./infrastructure/... -run TestBreakGlassTableSchema passes</verify>
  <done>BreakGlassTableSchema has comprehensive test coverage</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./infrastructure/...` succeeds
- [ ] `go test ./infrastructure/...` passes
- [ ] BreakGlassTableSchema GSIs match breakglass/dynamodb.go constants (gsi-invoker, gsi-status, gsi-profile)
</verification>

<success_criteria>

- BreakGlassTableSchema function added to infrastructure/schema.go
- Function follows exact pattern of ApprovalTableSchema
- GSI structure matches breakglass/dynamodb.go
- Tests verify all schema properties
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/89-breakglass-table-provisioning/89-01-SUMMARY.md`
</output>
