---
phase: 154-release-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [docs/CHANGELOG.md, main.go]
autonomous: false
---

<objective>
Prepare v2.0.0 release candidate with complete changelog and version updates.

Purpose: Create a production-ready release candidate that can be validated before final tagging.
Output: Updated CHANGELOG.md with v1.19, v1.20, v2.0 entries, version constants set to 2.0.0, release candidate tag.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/milestones/v1.19-ROADMAP.md
@.planning/milestones/v1.20-ROADMAP.md
@docs/CHANGELOG.md
@main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add v1.19 and v1.20 changelog entries</name>
  <files>docs/CHANGELOG.md</files>
  <action>
Add v1.19.0 and v1.20.0 entries to CHANGELOG.md after the v1.18.0 entry, following Keep a Changelog format:

**v1.19.0 - 2026-01-26:**
- Added: CHANGELOG completion for v1.13-v1.18 releases
- Added: Policy command documentation in commands.md (pull, push, diff, validate, sign, verify)
- Added: POLICY_SIGNING.md guide with KMS setup and Lambda TVM integration
- Added: DEVICE_POSTURE.md guide with Jamf Pro MDM setup
- Added: SECURITY_HARDENING.md guide for v1.16 features
- Added: README feature tables updated through v1.18
- Added: Deployment guide updated with KMS encryption and policy commands

**v1.20.0 - 2026-01-27:**
- Added: Policy linting with 3 checks (allow-before-deny, unreachable-rules, overlapping-time-windows)
- Added: Trust policy validation with 5 security rules (TRUST-01 to TRUST-05) and risk classification
- Added: `sentinel trust validate` command for IAM role audit
- Added: Deployment validation with SCP, DynamoDB, SSM, KMS checks (DEPLOY-01 to DEPLOY-04)
- Added: `sentinel deploy validate` command with remediation reports
- Added: `sentinel scp template` command for SCP generation (replaces direct deployment)
- Added: `sentinel dynamodb harden` command for deletion protection and PITR
- Added: `sentinel ssm backup` and `sentinel ssm restore` commands with KMS encryption
- Added: `sentinel monitoring setup` command for CloudTrail CloudWatch alarms
- Deprecated: `sentinel scp deploy` in favor of `sentinel scp template`

Insert these after [1.18.0] section, maintaining newest-first order.
  </action>
  <verify>grep -c "\[1.19.0\]" docs/CHANGELOG.md returns 1 AND grep -c "\[1.20.0\]" docs/CHANGELOG.md returns 1</verify>
  <done>CHANGELOG.md contains v1.19.0 and v1.20.0 entries with correct ship dates and feature lists</done>
</task>

<task type="auto">
  <name>Task 2: Add v2.0.0 changelog entry</name>
  <files>docs/CHANGELOG.md</files>
  <action>
Add v2.0.0 entry at the TOP of CHANGELOG.md (before v1.20.0), following Keep a Changelog format:

**v2.0.0 - 2026-01-27:**

### Added
- Microsoft Intune MDM provider for device posture verification (OAuth2 + Graph API)
- Intune device lookup by Azure AD device ID or device name
- Token refresh with 5-minute buffer for Azure AD OAuth tokens
- CLI integration tests for 60+ commands with help verification
- STRIDE threat coverage verification (100% coverage documented)
- Consolidated SCP reference documentation (SCP_REFERENCE.md)
- Example tests for CLI commands (credentials, policy validate/diff, shell init, whoami)
- Fuzz tests for policy YAML parsing, profile validation, identity validation, device validation

### Changed
- Go toolchain directive updated to go1.24.1 for byteness/keyring compatibility
- File permission hardening: SensitiveFileMode (0600) for policy/signature files
- SSM backup now uses KMS encryption by default (SEC-05 mitigation)
- SCP deployment replaced with template generation command (SCP-T-01 mitigation)

### Security
- SEC-01: SSM encrypted backup with KMS
- SEC-02: SCP template command replacing direct deployment
- SEC-03: File permission hardening for sensitive outputs
- SEC-04: Fuzz tests for CLI input validation
- SEC-05: KMS encryption required for SSM backup files

### Fixed
- Race detector analysis complete (code review confirmed no data races)
- DynamoDB expression attribute names (#pk pattern) for reserved words
- Error wrapping pattern: fmt.Errorf %w for errors.Is() compatibility
- Security sanitization strips control chars rather than rejecting

**Milestone Summary:** v2.0 Stable Release stabilizes Sentinel for production deployment with comprehensive testing, Intune MDM support, security hardening, and complete documentation.
  </action>
  <verify>grep -c "\[2.0.0\]" docs/CHANGELOG.md returns 1 AND head -20 docs/CHANGELOG.md | grep -q "2.0.0"</verify>
  <done>CHANGELOG.md has v2.0.0 as the first version entry with complete release notes</done>
</task>

<task type="auto">
  <name>Task 3: Update version constant to 2.0.0</name>
  <files>main.go</files>
  <action>
Update the Version constant in main.go from "dev" to "2.0.0":

Change:
  var Version = "dev"
To:
  var Version = "2.0.0"

This version is compiled into the binary and displayed via `sentinel --version`.
  </action>
  <verify>grep -q 'Version = "2.0.0"' main.go</verify>
  <done>main.go contains Version = "2.0.0"</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Updated CHANGELOG with v1.19, v1.20, v2.0 entries and version constant to 2.0.0</what-built>
  <how-to-verify>
    1. Review docs/CHANGELOG.md - verify v2.0.0 is at top, v1.20.0 and v1.19.0 follow
    2. Review main.go - verify Version = "2.0.0"
    3. Run: go build -o /tmp/sentinel . && /tmp/sentinel --version
    4. Confirm output shows "2.0.0"
    5. Review changelog entries for accuracy and completeness
  </how-to-verify>
  <resume-signal>Type "approved" to proceed with release candidate tagging, or describe issues to fix</resume-signal>
</task>

<task type="auto">
  <name>Task 4: Create release candidate tag</name>
  <files>N/A (git operation)</files>
  <action>
Create and push the v2.0.0-rc.1 release candidate tag:

1. Stage and commit changelog and version changes
2. Create annotated tag v2.0.0-rc.1 with message "v2.0.0 Release Candidate 1"
3. Do NOT push the tag (user will push when ready)

Commit message format:
```
release(v2.0): prepare release candidate

- Add v1.19.0 and v1.20.0 changelog entries
- Add v2.0.0 changelog entry with milestone summary
- Update Version constant to 2.0.0
- Create v2.0.0-rc.1 release candidate tag
```
  </action>
  <verify>git tag -l | grep -q "v2.0.0-rc.1"</verify>
  <done>v2.0.0-rc.1 tag exists locally, ready for push after validation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docs/CHANGELOG.md contains v2.0.0, v1.20.0, v1.19.0 entries in correct order
- [ ] main.go has Version = "2.0.0"
- [ ] go build succeeds
- [ ] Binary shows correct version
- [ ] v2.0.0-rc.1 tag exists
- [ ] All changes committed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User has approved changelog content
- Release candidate tag created and ready
</success_criteria>

<output>
After completion, create `.planning/phases/154-release-preparation/154-01-SUMMARY.md`
</output>
