---
phase: 72-security-validation
plan: 04
type: execute
wave: 3
depends_on: ["72-03"]
files_modified: [docs/CHANGELOG.md, docs/SECURITY.md]
autonomous: true
---

<objective>
Document the security fix with changelog entry and security advisory.

Purpose: Inform users about the security vulnerability that was fixed in v1.7.1 and how to upgrade.
Output: CHANGELOG.md entry and SECURITY.md advisory for the OS username bug fix.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/72-security-validation/72-03-SUMMARY.md

# Existing docs
@docs/CHANGELOG.md
@docs/SECURITY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CHANGELOG.md with v1.7.1 security fix entry</name>
  <files>docs/CHANGELOG.md</files>
  <action>
Add v1.7.1 release entry at the top of CHANGELOG.md:

```markdown
## [1.7.1] - 2026-01-19

### Security

- **CRITICAL**: Fixed policy evaluation using OS username instead of AWS identity
  - Prior to this fix, policy rules matching on `users` would evaluate against the local OS username, not the AWS-authenticated identity
  - An attacker could bypass user-based policy restrictions by running Sentinel as a different local user
  - All commands now extract username from AWS STS GetCallerIdentity ARN
  - Affects: credential issuance, break-glass authorization, approval workflows, request submission

### Added

- `sentinel whoami` command to display AWS identity and policy username
- `GetAWSUsername()` and `GetAWSIdentity()` helpers in identity package
- `STSAPI` interface for testability of AWS identity operations

### Changed

- All CLI commands now use AWS identity instead of OS username
- Policy evaluation uses sanitized username from AWS ARN
- Break-glass and approval authorization use AWS identity

### Fixed

- Policy bypass via OS user impersonation (security-critical)
```

Ensure the Security section is prominently placed and describes the vulnerability clearly.
  </action>
  <verify>cat docs/CHANGELOG.md | head -40 shows v1.7.1 entry with Security section</verify>
  <done>CHANGELOG.md updated with v1.7.1 security fix entry</done>
</task>

<task type="auto">
  <name>Task 2: Create or update SECURITY.md with vulnerability advisory</name>
  <files>docs/SECURITY.md</files>
  <action>
Create docs/SECURITY.md if it doesn't exist, or update it with:

```markdown
# Security

## Reporting Security Issues

If you discover a security vulnerability in Sentinel, please report it by emailing [security contact] or opening a private security advisory on GitHub.

## Security Advisories

### SENTINEL-2026-001: Policy Bypass via OS Username (Fixed in v1.7.1)

**Severity**: Critical
**Affected Versions**: v1.0.0 - v1.7.0
**Fixed Version**: v1.7.1

#### Summary

Sentinel versions prior to v1.7.1 used the local OS username (`os/user.Current()`) for policy evaluation instead of the AWS-authenticated identity. This allowed policy bypass through local user impersonation.

#### Impact

An attacker with local access could:
- Bypass user-based policy restrictions by running Sentinel as a different local user
- Invoke break-glass emergency access as unauthorized users
- Approve requests as unauthorized approvers
- Submit requests with spoofed requester identity

#### Root Cause

The credential issuance flow called `user.Current()` to get the username for policy evaluation. This returned the local OS username (e.g., from `/etc/passwd` on Linux) rather than the AWS-authenticated identity from STS GetCallerIdentity.

#### Fix

v1.7.1 replaces all `user.Current()` calls with `identity.GetAWSUsername()`, which:
1. Calls STS GetCallerIdentity to get the authenticated ARN
2. Parses the ARN to extract the username (IAM user name, assumed-role session name, etc.)
3. Sanitizes the username for policy matching

#### Affected Commands

- `sentinel credentials` - Policy evaluation for credential issuance
- `sentinel exec` - Policy evaluation for command execution
- `sentinel breakglass` - Authorization check for emergency access
- `sentinel approve/deny` - Approver identity verification
- `sentinel request` - Requester identity
- `sentinel list` - User filtering

#### Remediation

Upgrade to Sentinel v1.7.1 or later:

```bash
go install github.com/byteness/aws-vault/v7/cmd/sentinel@v1.7.1
```

#### Verification

After upgrading, verify the fix with:

```bash
# Should display your AWS identity, not OS username
sentinel whoami
```

#### Timeline

- 2026-01-18: Vulnerability identified during review
- 2026-01-19: Fix developed and tested
- 2026-01-19: v1.7.1 released with fix
```
  </action>
  <verify>cat docs/SECURITY.md shows vulnerability advisory with severity, impact, and remediation</verify>
  <done>SECURITY.md created/updated with vulnerability advisory</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docs/CHANGELOG.md has v1.7.1 entry with Security section
- [ ] docs/SECURITY.md exists with vulnerability advisory
- [ ] Advisory includes severity, affected versions, impact, fix, and remediation
- [ ] `go build ./...` still succeeds (no doc changes break build)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Changelog documents the security fix clearly
- Security advisory provides complete vulnerability disclosure
  </success_criteria>

<output>
After completion, create `.planning/phases/72-security-validation/72-04-SUMMARY.md`
</output>
