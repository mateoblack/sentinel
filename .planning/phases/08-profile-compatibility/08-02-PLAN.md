---
phase: 08-profile-compatibility
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified: [cli/sentinel_exec.go, cli/sentinel_exec_test.go]
autonomous: true
---

<objective>
Integrate profile validation into exec command.

Purpose: Consistent validation across all sentinel commands - exec should also fail fast with helpful errors.
Output: Exec command validates profile before policy evaluation, matching credentials command behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-profile-compatibility/08-01-SUMMARY.md

@cli/sentinel.go
@cli/sentinel_exec.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate profile validation into exec command</name>
  <files>cli/sentinel_exec.go</files>
  <action>
In SentinelExecCommand, after checking AWS_SENTINEL (step 0) and before creating logger (step 1), add profile validation:

```go
// 0.5. Validate profile exists in AWS config
if err := s.ValidateProfile(input.ProfileName); err != nil {
    fmt.Fprintf(os.Stderr, "%v\n", err)
    return 1, err
}
```

This ensures:
- Profile validation happens before any expensive operations (logger, AWS config, policy loading)
- Consistent error format with credentials command
- Returns exit code 1 on validation failure
  </action>
  <verify>go build ./... succeeds</verify>
  <done>Exec command validates profile before proceeding</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for exec profile validation</name>
  <files>cli/sentinel_exec_test.go</files>
  <action>
Add test case for profile validation in exec command:

```go
func TestSentinelExecCommand_InvalidProfile(t *testing.T) {
    // Test that invalid profile returns error before policy evaluation
    // Should fail fast with helpful message listing available profiles
}
```

Test should verify:
- Exit code is 1 (or non-zero)
- Error message contains "not found"
- Error mentions the profile name that wasn't found
  </action>
  <verify>go test ./cli/... -run TestSentinelExec passes</verify>
  <done>Exec command profile validation is tested</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] go build ./... succeeds
- [ ] go test ./cli/... passes
- [ ] Manual test: `go run ./cmd/sentinel exec --profile nonexistent --policy-parameter /test` shows error with available profiles
</verification>

<success_criteria>

- Exec command validates profile before policy evaluation
- Error message matches credentials command format
- Tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-profile-compatibility/08-02-SUMMARY.md`
</output>
