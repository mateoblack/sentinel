---
phase: 76-sso-credential-loading
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [cli/breakglass.go, cli/breakglass_check.go, cli/breakglass_close.go, cli/breakglass_list.go]
autonomous: true
---

<objective>
Add SSO profile credential loading to break-glass commands (breakglass, breakglass-check, breakglass-close, breakglass-list).

Purpose: Enable break-glass emergency access commands to work with SSO profiles.

Output: Break-glass commands that support SSO credential loading.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Commands and their --profile usage:**
- `breakglass` - has --profile (target profile for break-glass)
- `breakglass-check` - has --event-id, no profile flag
- `breakglass-close` - has --event-id, no profile flag
- `breakglass-list` - has filter flags, no profile flag

For breakglass command, use the --profile for AWS credential loading.
For other commands, add optional --aws-profile flag.

@cli/breakglass.go
@cli/breakglass_check.go
@cli/breakglass_close.go
@cli/breakglass_list.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add profile credential loading to breakglass command</name>
  <files>cli/breakglass.go</files>
  <action>
The breakglass command has a --profile flag that specifies the target profile for emergency access. Use this same profile for AWS credential loading.

Find the config loading section (around line 111-115):
```go
awsCfgOpts := []func(*config.LoadOptions) error{}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```

Change to:
```go
awsCfgOpts := []func(*config.LoadOptions) error{
    config.WithSharedConfigProfile(input.ProfileName),
}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>breakglass command uses profile for AWS config loading</done>
</task>

<task type="auto">
  <name>Task 2: Add --aws-profile flag to breakglass-check command</name>
  <files>cli/breakglass_check.go</files>
  <action>
Add optional --aws-profile flag to breakglass-check command.

1. Add AWSProfile field to BreakGlassCheckCommandInput struct:
```go
AWSProfile string // Optional AWS profile for credentials
```

2. Add the flag in ConfigureBreakGlassCheckCommand:
```go
cmd.Flag("aws-profile", "AWS profile for credentials (optional, uses default chain if not specified)").
    StringVar(&input.AWSProfile)
```

3. Modify the config loading (inside the function body where awsCfg is loaded):
```go
awsCfgOpts := []func(*config.LoadOptions) error{}
if input.AWSProfile != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithSharedConfigProfile(input.AWSProfile))
}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>breakglass-check command has optional --aws-profile flag</done>
</task>

<task type="auto">
  <name>Task 3: Add --aws-profile flag to breakglass-close and breakglass-list commands</name>
  <files>cli/breakglass_close.go, cli/breakglass_list.go</files>
  <action>
Apply the same pattern to breakglass-close and breakglass-list commands:

For cli/breakglass_close.go:
1. Add AWSProfile field to BreakGlassCloseCommandInput struct
2. Add --aws-profile flag in ConfigureBreakGlassCloseCommand
3. Update config loading to use profile if specified

For cli/breakglass_list.go:
1. Add AWSProfile field to BreakGlassListCommandInput struct
2. Add --aws-profile flag in ConfigureBreakGlassListCommand
3. Update config loading to use profile if specified

Use the same pattern as breakglass-check.
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>breakglass-close and breakglass-list commands have optional --aws-profile flag</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/... -v` passes
- [ ] breakglass command uses --profile for AWS config loading
- [ ] breakglass-check, breakglass-close, breakglass-list have optional --aws-profile flag
</verification>

<success_criteria>

- All tasks completed
- Break-glass commands support SSO credentials via profile specification
- No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/76-sso-credential-loading/76-03-SUMMARY.md`
</output>
