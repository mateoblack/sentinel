---
phase: 76-sso-credential-loading
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [cli/request.go, cli/approve.go, cli/deny.go, cli/sentinel_list.go]
autonomous: true
---

<objective>
Add SSO profile credential loading to approval workflow commands (request, approve, deny, list).

Purpose: Enable approval workflow commands to work with SSO profiles by loading credentials from the specified profile.

Output: Approval workflow commands that support SSO credential loading.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Problem:** Approval workflow commands use `config.LoadDefaultConfig(ctx)` without profile specification.

**Solution:** Add `config.WithSharedConfigProfile()` where profile is available.

**Note:**
- `request` has --profile flag (target profile for request)
- `approve` and `deny` don't have --profile (they use --request-id)
- `sentinel_list` has filter flags but no profile for credentials

For commands without --profile, we need to add a new `--credentials-profile` or `--aws-profile` flag to specify which profile to use for AWS API calls. This is a common pattern in AWS tools.

@cli/request.go
@cli/approve.go
@cli/deny.go
@cli/sentinel_list.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add profile credential loading to request command</name>
  <files>cli/request.go</files>
  <action>
The request command has a --profile flag that specifies the target profile for the access request. Use this same profile for AWS credential loading (the user needs credentials to call DynamoDB and STS).

Find the config loading section (around line 108-112):
```go
awsCfgOpts := []func(*config.LoadOptions) error{}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```

Change to:
```go
awsCfgOpts := []func(*config.LoadOptions) error{
    config.WithSharedConfigProfile(input.ProfileName),
}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>request command uses profile for AWS config loading</done>
</task>

<task type="auto">
  <name>Task 2: Add --aws-profile flag to approve command</name>
  <files>cli/approve.go</files>
  <action>
The approve command doesn't have a profile flag (it uses --request-id). Add an optional --aws-profile flag for specifying credentials profile.

1. Add AWSProfile field to ApproveCommandInput struct:
```go
type ApproveCommandInput struct {
    // ... existing fields ...
    AWSProfile string // Optional AWS profile for credentials
}
```

2. Add the flag in ConfigureApproveCommand:
```go
cmd.Flag("aws-profile", "AWS profile for credentials (optional, uses default chain if not specified)").
    StringVar(&input.AWSProfile)
```

3. Modify the config loading to use the profile if specified:
```go
awsCfgOpts := []func(*config.LoadOptions) error{}
if input.AWSProfile != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithSharedConfigProfile(input.AWSProfile))
}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
awsCfg, err := config.LoadDefaultConfig(ctx, awsCfgOpts...)
```
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>approve command has optional --aws-profile flag for SSO support</done>
</task>

<task type="auto">
  <name>Task 3: Add --aws-profile flag to deny and sentinel_list commands</name>
  <files>cli/deny.go, cli/sentinel_list.go</files>
  <action>
Apply the same pattern as approve command to deny and sentinel_list commands:

For cli/deny.go:
1. Add AWSProfile field to DenyCommandInput struct
2. Add --aws-profile flag in ConfigureDenyCommand
3. Update config loading to use profile if specified

For cli/sentinel_list.go:
1. Add AWSProfile field to SentinelListCommandInput struct
2. Add --aws-profile flag in ConfigureSentinelListCommand
3. Update config loading to use profile if specified

Both should use the same pattern:
```go
awsCfgOpts := []func(*config.LoadOptions) error{}
if input.AWSProfile != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithSharedConfigProfile(input.AWSProfile))
}
if input.Region != "" {
    awsCfgOpts = append(awsCfgOpts, config.WithRegion(input.Region))
}
```
  </action>
  <verify>go build ./cli/... succeeds</verify>
  <done>deny and sentinel_list commands have optional --aws-profile flag</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/... -v` passes
- [ ] request command uses --profile for AWS config loading
- [ ] approve, deny, sentinel_list have optional --aws-profile flag
</verification>

<success_criteria>

- All tasks completed
- Approval workflow commands support SSO credentials via profile specification
- No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/76-sso-credential-loading/76-02-SUMMARY.md`
</output>
