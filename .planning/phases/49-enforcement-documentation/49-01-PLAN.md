---
phase: 49-enforcement-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [docs/ENFORCEMENT.md, docs/ASSURANCE.md]
autonomous: true
---

<objective>
Update ENFORCEMENT.md with new v1.5 CLI commands and create ASSURANCE.md for verification procedures.

Purpose: Complete v1.5 Enforcement & Assurance milestone documentation, enabling teams to adopt and verify Sentinel enforcement.

Output: Updated ENFORCEMENT.md with enforce commands, new ASSURANCE.md with verification procedures.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context - v1.5 implementation details
@.planning/phases/48-require-sentinel-mode/48-01-SUMMARY.md

# Existing documentation to update
@docs/ENFORCEMENT.md
@docs/CLOUDTRAIL.md
@docs/BOOTSTRAP.md

# Key source files for command reference
@cli/enforce.go
@cli/audit.go
@cli/credentials.go
@enforce/analyze.go
@enforce/drift.go
@audit/verify.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ENFORCEMENT.md with v1.5 CLI commands</name>
  <files>docs/ENFORCEMENT.md</files>
  <action>
Add new sections to the existing ENFORCEMENT.md to document v1.5 enforcement commands:

1. Add section "## Enforcement CLI Commands" after "## How Enforcement Works":

**sentinel enforce plan --role=ROLE:**
- Purpose: Analyze a role's trust policy for Sentinel enforcement
- Flags: --role (required), --region, --json
- Example output showing enforcement status (Full, Partial, None)
- Interpretation guide for each status level

**sentinel enforce generate trust-policy:**
- Purpose: Generate ready-to-use IAM trust policy JSON
- Flags: --pattern (a/b/c), --principal (account/role ARN), --users (for pattern b)
- Examples for each pattern:
  - Pattern A: Any Sentinel credentials
  - Pattern B: Specific users via Sentinel
  - Pattern C: Migration (Sentinel OR legacy)

2. Add section "## Drift Detection" before "## Troubleshooting":
- Document --require-sentinel flag on credentials command
- Explain drift status values (OK, Partial, None, Unknown)
- Show example warning output
- Explain drift fields in decision logs (drift_status, drift_message)
- Note: Advisory only - credentials still issued

3. Add to "## Deployment Guide" section:
- Reference `sentinel enforce plan` for status checking
- Reference `sentinel enforce generate trust-policy` for generating policies
- Add step to verify with `sentinel audit verify` after deployment

Match existing documentation style: command reference tables, JSON examples, step-by-step guides.
  </action>
  <verify>docs/ENFORCEMENT.md contains sections for "enforce plan", "enforce generate trust-policy", and "--require-sentinel"</verify>
  <done>ENFORCEMENT.md updated with all v1.5 CLI commands and drift detection documentation</done>
</task>

<task type="auto">
  <name>Task 2: Create ASSURANCE.md for verification procedures</name>
  <files>docs/ASSURANCE.md</files>
  <action>
Create new documentation file docs/ASSURANCE.md covering verification procedures:

Structure:
```markdown
# Assurance Guide

How to verify Sentinel is actually enforced in your AWS environment.

## Overview

Sentinel assurance operates at three levels:
1. **Deployment verification** - Are trust policies correctly configured?
2. **Runtime verification** - Is Sentinel actually being used?
3. **Continuous monitoring** - Are there any bypass attempts or drift?

## Deployment Verification

### Check Role Enforcement Status

Use `sentinel enforce plan` to check enforcement status:
[command examples, output interpretation]

### Generate Compliant Trust Policies

Use `sentinel enforce generate trust-policy` to create policies:
[examples for patterns A, B, C]

### Bulk Verification

Script example to check all roles:
[bash script using enforce plan in loop]

## Runtime Verification

### CloudTrail Session Audit

Use `sentinel audit verify` to check recent sessions:
[command reference, flags, output interpretation]

**Command reference:**
- --start: Start of time window (ISO8601 or relative like "-24h")
- --end: End of time window
- --role: Filter by specific role (optional)
- --region: AWS region (optional)
- --json: Machine-readable output

**Interpreting results:**
- Pass rate calculation
- Issue types and what they mean
- Non-zero exit code for scripting

### Drift Detection at Credential Time

Enable --require-sentinel flag:
[configuration example]
[example warning output]

## Continuous Monitoring

### Periodic Audit Script

Cron job example for daily verification:
[script example]

### Alert Integration

How to integrate with monitoring systems:
- Exit codes for scripting
- JSON output for parsing
- Example: PagerDuty/Slack integration

### Dashboard Queries

Athena queries for Sentinel assurance metrics:
[queries for pass rate over time, issues by type, etc.]

## Verification Checklist

Checklist for teams adopting enforcement:
- [ ] Run `sentinel enforce plan` on all target roles
- [ ] Generate and apply trust policies
- [ ] Verify with `sentinel audit verify` over 24h window
- [ ] Enable --require-sentinel for drift warnings
- [ ] Set up continuous monitoring

## Troubleshooting

Common issues and resolutions:
- "Zero sessions found" - Check time window, role filter
- "Unknown enforcement status" - IAM permissions, role doesn't exist
- High percentage of non-Sentinel sessions - Migration incomplete
```

Match style of existing docs (ENFORCEMENT.md, CLOUDTRAIL.md, BOOTSTRAP.md).
  </action>
  <verify>docs/ASSURANCE.md exists with sections for deployment verification, runtime verification, and continuous monitoring</verify>
  <done>ASSURANCE.md created with comprehensive verification procedures</done>
</task>

<task type="auto">
  <name>Task 3: Update README.md with v1.5 features</name>
  <files>README.md</files>
  <action>
Update the README.md to reflect v1.5 Enforcement & Assurance features:

1. Update "### Validated" requirements section:
   - Add: ✓ Enforcement analyzer for trust policy verification — v1.5
   - Add: ✓ Trust policy generation for enforcement patterns — v1.5
   - Add: ✓ CloudTrail session verification with audit command — v1.5
   - Add: ✓ Drift detection with --require-sentinel flag — v1.5

2. Update "## Context" section:
   - Update LOC count after v1.5 (check with `find . -name '*.go' -not -path './vendor/*' | xargs wc -l | tail -1`)
   - Add v1.5 summary paragraph:
     "v1.5 adds enforcement and assurance:
     - Trust policy analyzer with enforcement status (Full/Partial/None)
     - Trust policy generator for patterns A/B/C
     - CloudTrail session verifier for compliance auditing
     - Drift detection at credential time with --require-sentinel flag"

3. Update "*Last updated*" timestamp at bottom.

Keep changes minimal - just add v1.5 information.
  </action>
  <verify>README.md contains v1.5 features in Validated section and Context section</verify>
  <done>README.md updated with v1.5 Enforcement & Assurance features</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `docs/ENFORCEMENT.md` updated with enforce plan, enforce generate, and drift detection
- [ ] `docs/ASSURANCE.md` created with verification procedures
- [ ] `README.md` updated with v1.5 features
- [ ] All markdown files are valid (no broken links or formatting issues)
</verification>

<success_criteria>

- ENFORCEMENT.md has sections for all v1.5 CLI commands
- ASSURANCE.md provides complete verification workflow
- README.md reflects v1.5 milestone completion
- Documentation style matches existing docs
- All tasks committed atomically
</success_criteria>

<output>
After completion, create `.planning/phases/49-enforcement-documentation/49-01-SUMMARY.md`
</output>
