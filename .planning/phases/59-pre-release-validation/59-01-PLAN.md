---
phase: 59-pre-release-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
---

<objective>
Generate comprehensive coverage report and identify remaining gaps for production readiness.

Purpose: Provide final coverage metrics and identify any critical gaps before v1.6 release.
Output: Coverage report with package-by-package analysis, gap identification, and go/no-go recommendation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate comprehensive coverage report</name>
  <files>None (analysis only)</files>
  <action>
Run comprehensive coverage analysis:

1. Run all tests with coverage and generate profile:
   ```bash
   go test ./... -coverprofile=coverage.out -covermode=atomic
   ```

2. Generate HTML coverage report:
   ```bash
   go tool cover -html=coverage.out -o coverage.html
   ```

3. Extract package-level coverage:
   ```bash
   go tool cover -func=coverage.out | grep total
   go tool cover -func=coverage.out | grep -E "%" | sort -t'%' -k2 -n
   ```

4. Identify Sentinel packages vs inherited aws-vault packages:
   - Sentinel packages: audit, bootstrap, breakglass, enforce, identity, logging, notification, policy, request, sentinel, testutil
   - Inherited aws-vault packages: cli, prompt, server, vault

5. Create coverage summary table with:
   - Package name
   - Coverage percentage
   - Classification (sentinel/aws-vault)
   - Status (meets 80% target / needs attention / inherited)

6. Calculate Sentinel-specific coverage (excluding inherited aws-vault code):
   - Target: >80% for Sentinel packages
   - Document any packages below threshold

Report format:
```
## Coverage Summary

Total coverage: X.X%
Sentinel packages coverage: X.X%
Target: 80%

### Package Coverage

| Package | Coverage | Type | Status |
|---------|----------|------|--------|
| policy | 99.0% | sentinel | âœ“ Exceeds target |
| ... | ... | ... | ... |

### Below Threshold

[List any Sentinel packages below 80%]

### Inherited Packages (excluded from target)

[List aws-vault packages with their coverage]

### Recommendation

[GO / NO-GO for release with justification]
```
  </action>
  <verify>coverage.out and coverage.html files generated; coverage summary captured</verify>
  <done>Comprehensive coverage report with package breakdown and Sentinel-specific metrics</done>
</task>

<task type="auto">
  <name>Task 2: Identify and document coverage gaps</name>
  <files>None (analysis only)</files>
  <action>
Analyze remaining uncovered code and categorize gaps:

1. For each Sentinel package, identify uncovered functions:
   ```bash
   go tool cover -func=coverage.out | grep "0.0%"
   ```

2. Categorize uncovered code:
   - **AWS constructors** (NewFromConfig patterns): Expected, not testable without AWS
   - **main() functions**: Entry points, not unit testable
   - **Defensive code paths**: Race condition guards, error paths
   - **Platform-specific code**: OS-specific implementations
   - **Critical gaps**: Actual missing test coverage

3. For each gap, determine:
   - Is it testable? (yes/no/with-integration)
   - Is it critical? (security-relevant, business logic)
   - Should it block release? (yes/no)

4. Document findings in structured format:
   ```
   ## Coverage Gap Analysis

   ### Expected Uncovered (acceptable)

   | Function | Package | Reason |
   |----------|---------|--------|
   | NewFromConfig | bootstrap | AWS constructor |
   | main | cmd/sentinel | Entry point |
   | ... | ... | ... |

   ### Gaps Needing Attention

   [List any critical gaps that should be addressed]

   ### Risk Assessment

   [Overall risk level: Low/Medium/High]
   [Justification for assessment]
   ```

5. Cross-reference with security-critical paths:
   - Policy evaluation: Should be >95%
   - Credential issuance: Should be >90%
   - Rate limiting: Should be >90%
   - State machines: Should be >85%
  </action>
  <verify>Gap analysis completed with categorization</verify>
  <done>All uncovered code categorized, critical gaps identified, risk assessment documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] coverage.out and coverage.html exist
- [ ] Package-level coverage extracted
- [ ] Sentinel vs aws-vault packages separated
- [ ] All uncovered functions categorized
- [ ] Critical path coverage verified
- [ ] GO/NO-GO recommendation documented
</verification>

<success_criteria>

- Comprehensive coverage metrics documented
- Package-by-package analysis complete
- Gaps categorized (expected vs needing attention)
- Security-critical paths verified at target thresholds
- Clear GO/NO-GO recommendation for release
</success_criteria>

<output>
After completion, create `.planning/phases/59-pre-release-validation/59-01-SUMMARY.md`
</output>
