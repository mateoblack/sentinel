---
phase: 90-session-table-provisioning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [infrastructure/schema.go, infrastructure/schema_test.go]
autonomous: true
---

<objective>
Add SessionTableSchema function to infrastructure/schema.go for session table provisioning.

Purpose: Enable `sentinel init sessions` command to create the sentinel-sessions DynamoDB table with correct schema matching session/dynamodb.go.
Output: SessionTableSchema(tableName string) function with tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase patterns - schema function pattern established
@.planning/phases/89-breakglass-table-provisioning/89-01-SUMMARY.md

# Source files - existing schema and session GSI constants
@infrastructure/schema.go
@session/dynamodb.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SessionTableSchema function</name>
  <files>infrastructure/schema.go</files>
  <action>
Add SessionTableSchema(tableName string) TableSchema function following BreakGlassTableSchema pattern exactly.

Schema must match session/dynamodb.go GSI constants:
- GSIUser = "gsi-user" (PK: user, SK: created_at)
- GSIStatus = "gsi-status" (PK: status, SK: created_at)
- GSIProfile = "gsi-profile" (PK: profile, SK: created_at)
- GSIServerInstance = "gsi-server-instance" (PK: server_instance_id, SK: status)

Note: GSIServerInstance has different sort key than others (status, not created_at).

Include doc comment explaining this matches session/dynamodb.go schema.
  </action>
  <verify>go build ./infrastructure/...</verify>
  <done>SessionTableSchema function exists and returns correct schema with 4 GSIs</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for SessionTableSchema</name>
  <files>infrastructure/schema_test.go</files>
  <action>
Add tests following TestBreakGlassTableSchema pattern:
1. TestSessionTableSchema - verify all schema properties (table name, PK, billing, TTL, GSI count)
2. TestSessionTableSchemaGSINames - verify GSI names match session/dynamodb.go constants

Test that gsi-server-instance has server_instance_id as PK and status as SK (different from other GSIs).
  </action>
  <verify>go test ./infrastructure/... -v -run TestSession</verify>
  <done>Tests pass and verify schema matches session/dynamodb.go GSI constants</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./infrastructure/...` succeeds
- [ ] `go test ./infrastructure/...` passes all tests
- [ ] SessionTableSchema returns 4 GSIs: gsi-user, gsi-status, gsi-profile, gsi-server-instance
- [ ] gsi-server-instance has server_instance_id PK and status SK
</verification>

<success_criteria>
- All tasks completed
- SessionTableSchema function exists with correct schema
- Tests verify all 4 GSIs and their key structures
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/90-session-table-provisioning/90-01-SUMMARY.md`
</output>
