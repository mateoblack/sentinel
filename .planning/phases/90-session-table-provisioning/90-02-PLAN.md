---
phase: 90-session-table-provisioning
plan: 02
type: execute
wave: 2
depends_on: ["90-01"]
files_modified: [cli/init_sessions.go, cli/init_sessions_test.go, cmd/sentinel/main.go]
autonomous: true
---

<objective>
Create `sentinel init sessions` CLI command for DynamoDB session table provisioning.

Purpose: Enable automated creation of sentinel-sessions table for server session tracking.
Output: Working CLI command with --plan, --generate-iam, --table, --region, --aws-profile, --yes flags.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase patterns - init subcommand pattern established
@.planning/phases/89-breakglass-table-provisioning/89-02-SUMMARY.md

# Source files - CLI pattern to follow exactly
@cli/init_breakglass.go
@cli/init_breakglass_test.go
@infrastructure/schema.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create init sessions CLI command</name>
  <files>cli/init_sessions.go</files>
  <action>
Create cli/init_sessions.go following cli/init_breakglass.go pattern exactly:

1. DefaultSessionTableName = "sentinel-sessions"

2. InitSessionsCommandInput struct with same fields as InitBreakGlassCommandInput

3. ConfigureInitSessionsCommand function:
   - Subcommand of init: "sessions"
   - Help: "Provision the DynamoDB server sessions table"
   - Same flags: --table (default sentinel-sessions), --region (required), --aws-profile, --plan, --yes/-y, --generate-iam

4. InitSessionsCommand function:
   - Use infrastructure.SessionTableSchema (from 90-01)
   - Same provisioning logic as InitBreakGlassCommand
   - Output: "Sentinel Init Sessions" header
   - IAM policy Sids: SentinelSessionTableProvisioning, SentinelSessionTableOperations

5. generateSessionTableIAMPolicy function:
   - Same structure as generateBreakGlassTableIAMPolicy
   - Sids: SentinelSessionTableProvisioning, SentinelSessionTableOperations

6. Next steps output:
   - Configure --session-table flag in sentinel exec --server
   - Or set SENTINEL_SESSION_TABLE environment variable
  </action>
  <verify>go build ./cli/...</verify>
  <done>init_sessions.go compiles with full provisioning logic</done>
</task>

<task type="auto">
  <name>Task 2: Register command and add tests</name>
  <files>cli/init_sessions_test.go, cmd/sentinel/main.go</files>
  <action>
1. In cmd/sentinel/main.go:
   - Add cli.ConfigureInitSessionsCommand(app, &s) after ConfigureInitBreakGlassCommand

2. Create cli/init_sessions_test.go following cli/init_breakglass_test.go pattern:
   - TestGenerateSessionTableIAMPolicy - verify IAM policy structure and Sids
   - TestInitSessionsCommandInput_Defaults - verify default table name

Test that IAM policy has:
- SentinelSessionTableProvisioning Sid with CreateTable, DescribeTable, UpdateTimeToLive
- SentinelSessionTableOperations Sid with GetItem, PutItem, UpdateItem, DeleteItem, Query, Scan
- Table and index ARN resources
  </action>
  <verify>go test ./cli/... -v -run TestGenerateSessionTableIAM && go test ./cli/... -v -run TestInitSessionsCommandInput</verify>
  <done>Command registered and tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./cli/... -run Session` passes
- [ ] `sentinel init sessions --help` shows expected flags
- [ ] `sentinel init sessions --generate-iam --table sentinel-sessions --region us-east-1` outputs valid IAM policy
</verification>

<success_criteria>
- All tasks completed
- init sessions command registered and functional
- IAM policy generation works with correct Sids
- Tests verify policy structure and defaults
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/90-session-table-provisioning/90-02-SUMMARY.md`
</output>
