---
phase: 24-notification-hooks
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified: [notification/sns.go, notification/sns_test.go, go.mod]
autonomous: true
---

<objective>
Implement SNS notifier that publishes request events to an AWS SNS topic.

Purpose: Enable AWS-native notification delivery for request lifecycle events (email, SMS, Lambda triggers).
Output: SNS notifier implementation with tests and mock support.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@notification/types.go
@notification/notifier.go
@request/dynamodb.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SNS SDK dependency</name>
  <files>go.mod</files>
  <action>
Run: go get github.com/aws/aws-sdk-go-v2/service/sns

This adds the SNS service client to go.mod. The aws-sdk-go-v2 core is already a dependency.
  </action>
  <verify>grep "service/sns" go.mod</verify>
  <done>SNS SDK added to go.mod</done>
</task>

<task type="auto">
  <name>Task 2: Implement SNS notifier</name>
  <files>notification/sns.go, notification/sns_test.go</files>
  <action>
Create notification/sns.go:

1. snsAPI interface (for testing):
   - Publish(ctx context.Context, params *sns.PublishInput, optFns ...func(*sns.Options)) (*sns.PublishOutput, error)

2. SNSNotifier struct:
   - client snsAPI
   - topicARN string

3. NewSNSNotifier(cfg aws.Config, topicARN string) *SNSNotifier:
   - Create SNS client from config
   - Store topicARN

4. newSNSNotifierWithClient(client snsAPI, topicARN string) *SNSNotifier:
   - For testing with mock client

5. Notify(ctx context.Context, event *Event) error:
   - Marshal event to JSON
   - sns.Publish with:
     - TopicArn: topicARN
     - Message: JSON string
     - MessageAttributes: "event_type" = event.Type (for filtering)
   - Return error if publish fails

Follow the DynamoDB pattern from request/dynamodb.go (interface for mock, NewFromConfig, internal constructor with client).

Create notification/sns_test.go:
- Mock snsAPI implementation
- TestSNSNotifier_Notify verifies correct Publish call
- TestSNSNotifier_Notify_Error handles publish failure
- Verify message contains event JSON
- Verify MessageAttributes has event_type
  </action>
  <verify>go test ./notification/... -v -run SNS</verify>
  <done>SNSNotifier publishes to topic with JSON payload and event_type attribute</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./notification/...` passes
- [ ] SNS dependency added to go.mod
- [ ] SNSNotifier follows existing AWS service patterns
</verification>

<success_criteria>

- All tasks completed
- SNS SDK dependency added
- SNSNotifier implements Notifier interface
- Tests verify publish behavior with mock
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/24-notification-hooks/24-02-SUMMARY.md`
</output>
