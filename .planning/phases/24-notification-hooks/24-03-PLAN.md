---
phase: 24-notification-hooks
plan: 03
type: execute
wave: 2
depends_on: ["24-01"]
files_modified: [notification/webhook.go, notification/webhook_test.go]
autonomous: true
---

<objective>
Implement webhook notifier that POSTs request events to a configurable HTTP endpoint.

Purpose: Enable webhook-based notification delivery for integration with Slack, PagerDuty, custom systems.
Output: Webhook notifier with retry logic and tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@notification/types.go
@notification/notifier.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement webhook notifier</name>
  <files>notification/webhook.go</files>
  <action>
Create notification/webhook.go:

1. WebhookNotifier struct:
   - url string
   - client *http.Client
   - maxRetries int
   - retryDelay time.Duration

2. WebhookConfig struct (for configuration):
   - URL string
   - TimeoutSeconds int (default 10)
   - MaxRetries int (default 3)
   - RetryDelaySeconds int (default 1)

3. NewWebhookNotifier(config WebhookConfig) (*WebhookNotifier, error):
   - Validate URL is non-empty and valid
   - Create http.Client with timeout
   - Apply defaults for zero values
   - Return error if URL invalid

4. Notify(ctx context.Context, event *Event) error:
   - Marshal event to JSON
   - HTTP POST to url with:
     - Content-Type: application/json
     - X-Sentinel-Event: event.Type (for filtering)
   - Retry on 5xx errors or network errors (up to maxRetries)
   - Exponential backoff: retryDelay * 2^attempt
   - Return error after all retries exhausted
   - Success on 2xx status

Keep retry logic simple - no external library needed. Use time.Sleep for delay (context-aware).
  </action>
  <verify>go build ./notification/...</verify>
  <done>WebhookNotifier POSTs JSON to configured URL with retry logic</done>
</task>

<task type="auto">
  <name>Task 2: Add webhook tests</name>
  <files>notification/webhook_test.go</files>
  <action>
Create notification/webhook_test.go:

1. Use httptest.NewServer for mock HTTP server

2. TestWebhookNotifier_Notify:
   - Mock server returns 200
   - Verify request body is valid JSON
   - Verify Content-Type header
   - Verify X-Sentinel-Event header

3. TestWebhookNotifier_Notify_Retry:
   - Mock server returns 500 twice, then 200
   - Verify notifier retries and eventually succeeds
   - Count request attempts

4. TestWebhookNotifier_Notify_AllRetriesFail:
   - Mock server always returns 500
   - Verify error returned after max retries

5. TestNewWebhookNotifier_InvalidURL:
   - Empty URL returns error
   - Invalid URL format returns error

6. TestWebhookNotifier_Notify_ContextCancelled:
   - Cancel context during retry
   - Verify returns context error
  </action>
  <verify>go test ./notification/... -v -run Webhook</verify>
  <done>Webhook tests cover success, retry, failure, and cancellation cases</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go test ./notification/...` passes
- [ ] Retry logic works correctly
- [ ] Context cancellation is respected
</verification>

<success_criteria>

- All tasks completed
- WebhookNotifier implements Notifier interface
- Retry logic with exponential backoff
- Tests verify all edge cases
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/24-notification-hooks/24-03-SUMMARY.md`
</output>
