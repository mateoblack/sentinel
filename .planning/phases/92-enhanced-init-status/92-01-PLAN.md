---
phase: 92-enhanced-init-status
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [bootstrap/status.go, bootstrap/status_test.go, cli/status.go, cli/status_test.go]
autonomous: true
---

<objective>
Add DynamoDB table status checking to `sentinel init status` command.

Purpose: Allow users to see the status of all Sentinel infrastructure (SSM parameters and DynamoDB tables) in a single command, enabling quick health checks after deployment.

Output: Extended status command showing both SSM parameters and DynamoDB table status.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@bootstrap/status.go
@cli/status.go
@infrastructure/provisioner.go
@infrastructure/schema.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add infrastructure status types and checker to bootstrap package</name>
  <files>bootstrap/status.go, bootstrap/status_test.go</files>
  <action>
Extend the bootstrap package with infrastructure status checking:

1. Add new types in status.go:

```go
// TableInfo holds status information about a DynamoDB table.
type TableInfo struct {
    TableName string `json:"table_name"`
    Status    string `json:"status"`    // ACTIVE, NOT_FOUND, CREATING, etc.
    Region    string `json:"region"`
    Purpose   string `json:"purpose"`   // "approvals", "breakglass", "sessions"
}

// InfrastructureStatus holds status of all infrastructure components.
type InfrastructureStatus struct {
    Tables []TableInfo `json:"tables"`
}
```

2. Add interface for DynamoDB status checking (for testability):

```go
// dynamoDBStatusAPI defines operations for checking table status.
type dynamoDBStatusAPI interface {
    DescribeTable(ctx context.Context, params *dynamodb.DescribeTableInput, optFns ...func(*dynamodb.Options)) (*dynamodb.DescribeTableOutput, error)
}
```

3. Add InfrastructureChecker type with GetInfrastructureStatus method that checks the three known tables:
   - sentinel-requests (approvals)
   - sentinel-breakglass (breakglass)
   - sentinel-sessions (sessions)

4. Use existing infrastructure.TableProvisioner pattern - DescribeTable returns ResourceNotFoundException for missing tables, catch and return "NOT_FOUND" status.

5. Add newInfrastructureCheckerWithClient constructor for testing with mock.

6. Add tests for InfrastructureChecker covering:
   - All tables exist and ACTIVE
   - Some tables missing (NOT_FOUND)
   - Table in CREATING state
   - API error handling
  </action>
  <verify>go build ./bootstrap/... && go test ./bootstrap/... -run TestInfrastructure</verify>
  <done>InfrastructureChecker type exists with GetInfrastructureStatus method, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Extend CLI status command with infrastructure display</name>
  <files>cli/status.go, cli/status_test.go</files>
  <action>
Extend the status command to show infrastructure status:

1. Add fields to StatusCommandInput:
   - CheckTables bool (flag to enable table checking)
   - ApprovalTableName string (default: sentinel-requests)
   - BreakGlassTableName string (default: sentinel-breakglass)
   - SessionTableName string (default: sentinel-sessions)
   - InfrastructureChecker *bootstrap.InfrastructureChecker (for testing)

2. Add --check-tables flag (default true when region is provided, false otherwise)

3. Add optional table name flags for custom table names (same pattern as init approvals command)

4. Extend StatusResult display in human output to show:
```
Sentinel Status
===============

Policy Parameters (/sentinel/policies):
  dev            v7   (last modified: 2026-01-19 10:14:04)
  ai-readonly    v4   (last modified: 2026-01-19 10:33:02)

Total: 2 policy parameters

Infrastructure:
  sentinel-requests    approvals    ACTIVE
  sentinel-breakglass  breakglass   NOT FOUND
  sentinel-sessions    sessions     NOT FOUND
```

5. For JSON output, add infrastructure field to result struct

6. When --check-tables enabled but no region specified, output error message explaining region is required for table checks

7. Add tests for:
   - Status with --check-tables showing infrastructure
   - JSON output with infrastructure
   - Missing region error message
   - All tables present vs some missing
  </action>
  <verify>go build ./cli/... && go test ./cli/... -run TestStatus</verify>
  <done>Status command shows infrastructure status, tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./bootstrap/... ./cli/...` succeeds
- [ ] `go test ./bootstrap/... -run TestInfrastructure` passes
- [ ] `go test ./cli/... -run TestStatus` passes
- [ ] No new linting errors
</verification>

<success_criteria>

- InfrastructureChecker type implemented with GetInfrastructureStatus method
- Status command shows infrastructure section when --check-tables enabled
- JSON output includes infrastructure array
- Tests cover happy path and error cases
</success_criteria>

<output>
After completion, create `.planning/phases/92-enhanced-init-status/92-01-SUMMARY.md`
</output>
