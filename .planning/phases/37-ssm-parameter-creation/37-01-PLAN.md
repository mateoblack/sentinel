---
phase: 37-ssm-parameter-creation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [bootstrap/executor.go, bootstrap/executor_test.go]
autonomous: true
---

<objective>
Implement SSM parameter creation with proper error handling and versioning awareness.

Purpose: Enable Sentinel bootstrap to actually create SSM policy parameters, not just plan them.
Output: Executor struct with Apply() method that creates SSM parameters based on a BootstrapPlan.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (direct dependencies)
@.planning/phases/35-bootstrap-schema/35-01-SUMMARY.md
@.planning/phases/36-bootstrap-planner/36-01-SUMMARY.md

# Source files to build on
@bootstrap/planner.go
@bootstrap/types.go
@bootstrap/validate.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Executor with Apply method for SSM parameter creation</name>
  <files>bootstrap/executor.go</files>
  <action>
Create Executor struct following the same pattern as Planner:

1. Define ssmWriterAPI interface (extends ssmAPI pattern):
   - PutParameter(ctx, *ssm.PutParameterInput, ...func(*ssm.Options)) (*ssm.PutParameterOutput, error)

2. Create Executor struct:
   - ssm ssmWriterAPI field
   - NewExecutor(cfg aws.Config) *Executor constructor
   - newExecutorWithClient(client ssmWriterAPI) *Executor for testing

3. Implement Apply(ctx, *BootstrapPlan) (*ApplyResult, error):
   - Iterate plan.Resources
   - Skip resources where State is StateExists or StateSkip
   - For StateCreate: call PutParameter with Type=String, Overwrite=false
   - For StateUpdate: call PutParameter with Type=String, Overwrite=true
   - Track successes and failures in ApplyResult
   - Continue on individual failures (don't abort entire apply)

4. Define ApplyResult struct:
   - Created []string (names of created parameters)
   - Updated []string (names of updated parameters)
   - Skipped []string (names of skipped parameters)
   - Failed []ApplyError (parameter name + error message)

5. Define ApplyError struct:
   - Name string
   - Error string

6. Handle SSM-specific errors:
   - ParameterAlreadyExists: Add to Failed with clear message
   - Other errors: Add to Failed with wrapped message

Use String type for parameters (not SecureString) since policy YAML is not sensitive.
Use aws.Bool(false) for Overwrite on create to detect race conditions.
  </action>
  <verify>go build ./bootstrap/... compiles without errors</verify>
  <done>Executor struct with Apply method exists, handles create/update/skip states</done>
</task>

<task type="auto">
  <name>Task 2: Add comprehensive tests for Executor</name>
  <files>bootstrap/executor_test.go</files>
  <action>
Create comprehensive tests following planner_test.go pattern:

1. Define mockSSMWriterAPI struct:
   - putParameterFunc field for custom behavior
   - calls []PutParameterCall to track calls
   - PutParameterCall struct with Name, Value, Overwrite, Type fields

2. Test cases:
   - TestExecutor_Apply_CreateSuccess: StateCreate resource → PutParameter called with Overwrite=false
   - TestExecutor_Apply_UpdateSuccess: StateUpdate resource → PutParameter called with Overwrite=true
   - TestExecutor_Apply_SkipExisting: StateExists resource → no PutParameter call
   - TestExecutor_Apply_SkipMarked: StateSkip resource → no PutParameter call
   - TestExecutor_Apply_MultipleResources: Mix of create/update/skip states
   - TestExecutor_Apply_CreateAlreadyExists: ParameterAlreadyExists error → added to Failed
   - TestExecutor_Apply_GenericError: Other SSM error → added to Failed
   - TestExecutor_Apply_ContinuesOnError: One failure doesn't abort remaining creates
   - TestExecutor_Apply_IAMPolicySkipped: ResourceTypeIAMPolicy resources are skipped (not SSM)
   - TestExecutor_Apply_EmptyPlan: Empty resources list → empty result

3. Verify each test:
   - Correct PutParameter calls made (or not made for skips)
   - Correct ApplyResult fields populated
   - Error messages are descriptive
  </action>
  <verify>go test ./bootstrap/... -v passes all tests</verify>
  <done>All Executor tests pass, covering create/update/skip/error scenarios</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./bootstrap/...` succeeds
- [ ] `go test ./bootstrap/...` passes all tests
- [ ] `go vet ./bootstrap/...` reports no issues
</verification>

<success_criteria>

- Executor struct with Apply method implemented
- ssmWriterAPI interface defined (parallel to ssmAPI for reads)
- ApplyResult tracks created/updated/skipped/failed resources
- Continues processing on individual failures
- Comprehensive tests covering all code paths
- No new linting warnings
</success_criteria>

<output>
After completion, create `.planning/phases/37-ssm-parameter-creation/37-01-SUMMARY.md`
</output>
