# Milestone v1.20: CLI Security & Deployment Helpers

**Status:** âœ… SHIPPED 2026-01-27
**Phases:** 143-149
**Total Plans:** 7

## Overview

Complete CLI feature set with policy validation, trust policy auditing, and self-service AWS account hardening helpers. Enable users to validate Sentinel configurations, detect security misconfigurations, and harden AWS infrastructure without manual processes.

## Phases

### Phase 143: Policy Linting

**Goal:** Users can validate Sentinel policies for common errors before deployment
**Depends on:** Phase 142 (v1.19 completion)
**Plans:** 1 plan

Plans:
- [x] 143-01: Policy linting implementation

**Details:**
- LintPolicy function with three lint checks: allow-before-deny, unreachable-rules, overlapping-time-windows
- Compiler-style output format: `lint: {type}: {message}`
- Integration into existing `sentinel policy validate` command
- Lint warnings do NOT change exit code (exit 0 if schema valid)

### Phase 144: Trust Policy Validation

**Goal:** Users can audit IAM role trust policies for Sentinel security violations
**Depends on:** Phase 143
**Plans:** 1 plan

Plans:
- [x] 144-01: Trust policy validation

**Details:**
- ValidateTrustPolicy with 5 security rules (TRUST-01 to TRUST-05)
- Risk classification (HIGH/MEDIUM/LOW) for findings
- Advisor.ValidateRole, ValidateRoles, and ListRolesByPrefix methods
- `sentinel trust validate` CLI command with batch support
- Exit codes: 0=compliant, 1=HIGH findings, 2=MEDIUM only

### Phase 145: Deployment Validation

**Goal:** Users can audit complete Sentinel deployment security posture
**Depends on:** Phase 144
**Plans:** 1 plan

Plans:
- [x] 145-01: Deployment validation implementation

**Details:**
- Auditor with DynamoDB, SSM, KMS, and SCP infrastructure checks
- 5 audit checks: DEPLOY-01 (SCP), DEPLOY-02 (DynamoDB), DEPLOY-02b (PITR), DEPLOY-03 (SSM), DEPLOY-04 (KMS)
- `sentinel deploy validate` CLI command with categorized output
- Remediation report with copy-paste ready commands
- Graceful degradation for access denied scenarios

### Phase 146: SCP Deployment

**Goal:** Users can deploy recommended SCPs to enforce Sentinel requirements
**Depends on:** Phase 145
**Plans:** 1 plan

Plans:
- [x] 146-01: SCP deployment implementation

**Details:**
- SCPDeployer for creating/updating Sentinel SCP policies
- SentinelSCPPolicy constant with SourceIdentity enforcement
- `sentinel scp deploy` CLI command with dry-run and OU targeting
- Confirmation prompt with --force bypass for CI/CD
- Exit codes: 0=success, 1=failure, 2=user cancelled

### Phase 147: DynamoDB Hardening

**Goal:** Users can enable deletion protection and PITR on Sentinel tables
**Depends on:** Phase 146
**Plans:** 1 plan

Plans:
- [x] 147-01: DynamoDB hardening implementation

**Details:**
- DynamoDBHardener with table discovery and batch hardening
- DiscoverSentinelTables by prefix pattern (default: sentinel-)
- HardenTable with idempotent behavior (reports no changes if already protected)
- `sentinel dynamodb harden` CLI command with auto-discovery
- Status preview and confirmation prompt

### Phase 148: SSM Hardening

**Goal:** Users can enable versioning and create backups for Sentinel parameters
**Depends on:** Phase 147
**Plans:** 1 plan

Plans:
- [x] 148-01: SSM backup and restore commands

**Details:**
- SSMHardener with parameter discovery and backup/restore capabilities
- DiscoverSentinelParameters by prefix (default: /sentinel/)
- BackupParameters creates JSON files with version tracking
- RestoreParameters compares versions and skips unchanged
- `sentinel ssm backup` and `sentinel ssm restore` CLI commands

### Phase 149: CloudTrail Monitoring

**Goal:** Users can create CloudWatch alarms for Sentinel security events
**Depends on:** Phase 148
**Plans:** 1 plan

Plans:
- [x] 149-01: CloudTrail monitoring implementation

**Details:**
- MonitoringSetup with CloudWatch alarm creation capabilities
- 4 metric filter configurations for CloudTrail security events:
  - sentinel-kms-key-changes: KMS DisableKey/ScheduleKeyDeletion
  - sentinel-dynamodb-delete: DynamoDB DeleteTable for sentinel-* tables
  - sentinel-ssm-delete: SSM DeleteParameter for /sentinel/* parameters
  - sentinel-unmanaged-assume-role: AssumeRole without sourceIdentity
- SNS topic with email subscription support
- `sentinel monitoring setup` CLI command with dry-run and selective alarm creation
- Single occurrence threshold (threshold=1) for immediate alerting

---

## Milestone Summary

**Key Decisions:**
- Lint warnings do NOT change exit code (exit 0 if schema valid)
- Compiler-style lint output: `lint: {type}: {message}`
- Trust validation exit codes: 0=compliant, 1=HIGH, 2=MEDIUM only
- Deployment validation with 5 audit checks (DEPLOY-01 to DEPLOY-04)
- SCP enforcement check with graceful degradation for non-management accounts
- SCP deploy command with confirmation prompt, --force bypass for CI/CD
- DynamoDB hardening with idempotent HardenTable behavior
- Table discovery by prefix pattern (default: sentinel-)
- SSM backup creates local JSON files with version tracking
- SSM restore compares versions and skips unchanged parameters
- Single occurrence threshold for CloudTrail alarms

**Issues Resolved:**
- Complete CLI feature set for self-service security hardening
- Users can validate policies without deployment
- Users can audit and remediate infrastructure security gaps
- One-command hardening for DynamoDB, SSM, and CloudWatch

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
