# Milestone v1.10: Real-time Revocation

**Status:** SHIPPED 2026-01-20
**Phases:** 78-83
**Total Plans:** 15

## Overview

Enable instant credential revocation via server mode - each credential request checks Sentinel policy, allowing real-time blocking of access. Server mode evaluates policy on every request instead of caching credentials, enabling immediate revocation when sessions are terminated or policies change.

## Phases

### Phase 78: Server Infrastructure

**Goal**: Port ECS server mode to sentinel exec command with --server flag
**Depends on**: v1.9 complete
**Plans**: 2 plans

Plans:
- [x] 78-01: SentinelServer type with policy-aware credential serving
- [x] 78-02: --server flag CLI integration for sentinel exec command

**Details:**
- Created SentinelServer HTTP credential server with policy evaluation on every request
- Implemented CredentialProvider interface for testable credential retrieval
- Added support for approved request and break-glass overrides
- Added --server (-s), --server-port, --lazy flags to sentinel exec command
- Created sentinelCredentialProviderAdapter to bridge CLI and sentinel package types

### Phase 79: Server Policy Integration

**Goal**: Hook policy evaluation into credential server requests
**Depends on**: Phase 78
**Plans**: 2 plans

Plans:
- [x] 79-01: Add credential mode awareness to policy schema
- [x] 79-02: Add server mode integration tests and documentation

**Details:**
- Added CredentialMode type (ModeServer, ModeCLI, ModeCredentialProcess) to policy schema
- Extended Condition struct with Mode field for rule-based mode matching
- Implemented matchesMode function with empty-list-wildcard semantics
- Updated all policy.Request creation sites to pass appropriate Mode value
- Added mode condition documentation in policy-reference.md
- Added --server flag documentation in commands.md

### Phase 80: Short-lived Sessions

**Goal**: Enforce short credential TTLs in server mode for rapid revocation
**Depends on**: Phase 79
**Plans**: 1 plan

Plans:
- [x] 80-01: Server duration defaults and policy caps

**Details:**
- Added DefaultServerSessionDuration constant (15 min) balancing security with SDK caching
- Added --server-duration CLI flag for explicit session duration control
- Added MaxServerDuration field to policy Rule for per-rule duration limits
- Applied policy-based duration capping in server credential handler
- Capping order: config -> policy cap -> break-glass cap -> final

### Phase 81: Session Management

**Goal**: Track and manage active server sessions for visibility and control
**Depends on**: Phase 80
**Plans**: 4 plans

Plans:
- [x] 81-01: Session schema, Store interface, and DynamoDB implementation
- [x] 81-02: Session lifecycle integration (create on startup, touch on request, expire on shutdown)
- [x] 81-03: Server session CLI commands (list, detail)
- [x] 81-04: Session revocation (CLI command, server-side check, tests)

**Details:**
- Created session package with ServerSession type (active/revoked/expired state machine)
- Defined Store interface with CRUD, query, and Touch operations
- Implemented DynamoDB Store with 4 GSIs and optimistic locking
- Session tracking is best-effort (failures logged, not blocking)
- Added sentinel server-sessions list and server-session detail commands
- Added sentinel server-revoke command for security teams
- Revocation check fails-closed for security (revoked = deny immediately)
- Store errors fail-open for availability (don't block credentials)

### Phase 82: Server Mode Enforcement

**Goal**: Policy conditions to require server mode for sensitive profiles
**Depends on**: Phase 81
**Plans**: 3 plans

Plans:
- [x] 82-01: Require server effect schema (EffectRequireServer, RequiresServerMode flag)
- [x] 82-02: CLI error handling for require_server denials
- [x] 82-03: Server integration tests and documentation

**Details:**
- Added EffectRequireServer constant converting to allow/deny based on mode
- Added RequiresServerMode field to Decision for targeted error messages
- require_server denials checked BEFORE approval/break-glass bypass
- Actionable error messages guide users to use --server flag
- Documented require_server effect in policy-reference.md

### Phase 83: Server Mode Testing

**Goal**: Comprehensive testing for server mode and revocation timing
**Depends on**: Phase 82
**Plans**: 3 plans

Plans:
- [x] 83-01: Server integration tests (revocation check fail-closed/fail-open)
- [x] 83-02: Server session CLI tests (list, detail, revoke commands)
- [x] 83-03: Server load tests (HTTP load, revocation timing, concurrent stress)

**Details:**
- TestSentinelServer_SessionRevoked_DeniesCredentials verifies fail-closed security
- TestSentinelServer_SessionRevocationStoreError_AllowsCredentials verifies fail-open availability
- Server-revoke command tests covering success, error cases, and input validation
- Server HTTP load tests verifying 100 req/sec with >99% success rate
- Revocation timing test proving sub-100ms propagation
- Concurrent stress test with 50 goroutines x 100 requests

---

## Milestone Summary

**Key Decisions:**
- SentinelServer evaluates policy on every credential request for real-time revocation
- DefaultServerSessionDuration=15min balances security (rapid revocation) with performance (SDK caching)
- Session tracking is best-effort - failures don't block credential serving
- Revocation check fails-closed for security, store errors fail-open for availability
- require_server effect cannot be bypassed by approval workflows or break-glass
- Mode check added as final condition in policy matching (after profiles, users, time)

**Issues Resolved:**
- None - clean implementation

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None - all tests validated syntactically (Go 1.25 toolchain not available in dev environment)

---

_For current project status, see .planning/ROADMAP.md_
