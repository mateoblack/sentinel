# Milestone v1.7: Permissions Discovery

**Status:** SHIPPED 2026-01-18
**Phases:** 60-68
**Total Plans:** 10

## Overview

Help users understand and configure Sentinel permissions without trial-and-error. Commands to discover required IAM actions, validate current permissions, and streamline onboarding.

## Phases

### Phase 60: Permissions Schema

**Goal**: Define permission requirements per subsystem, map features to IAM actions
**Depends on**: v1.6 complete
**Plans**: 1 plan

Plans:
- [x] 60-01: Permission types and registry

**Details:**
Created new `permissions` package with foundational types. Defined 8 subsystems and 10 features covering all Sentinel capabilities. Built registry mapping features to accurate IAM actions from codebase analysis. Implemented query functions for permission discovery.

### Phase 61: Permissions Command

**Goal**: `sentinel permissions` CLI with JSON/Terraform/CloudFormation output formats
**Depends on**: Phase 60
**Plans**: 1 plan

Plans:
- [x] 61-01: Permission formatters and CLI command

**Details:**
Created four permission formatters: human-readable, JSON IAM policy, Terraform HCL, CloudFormation YAML. Built `sentinel permissions` CLI command with subsystem/feature filtering and required-only mode. Implemented groupByResource helper for consolidating permissions by ARN pattern.

### Phase 62: Feature Detection

**Goal**: Auto-detect which subsystems are configured, suggest minimal permissions
**Depends on**: Phase 61
**Plans**: 1 plan

Plans:
- [x] 62-01: Detection types, detector logic, --detect CLI flag

**Details:**
Created Detector type with SSM and DynamoDB client interfaces. Implemented best-effort detection that collects errors without stopping. Added DetectorInterface for mock injection in CLI tests. Detection summary shows on stderr in human format only.

### Phase 63: Permission Validation

**Goal**: `sentinel permissions check` to verify current creds have required access
**Depends on**: Phase 62
**Plans**: 1 plan

Plans:
- [x] 63-01: Checker types, IAM SimulatePrincipalPolicy, CLI subcommand

**Details:**
Checker type with IAM SimulatePrincipalPolicy integration for permission validation. `sentinel permissions check` CLI subcommand with --auto-detect, --features, --output, --aws-region flags. Human and JSON output formats with per-feature and per-permission status.

### Phase 64: Guided Setup

**Goal**: `sentinel init` wizard for interactive first-time configuration
**Depends on**: Phase 63
**Plans**: 1 plan

Plans:
- [x] 64-01: Wizard types, flow logic, CLI command

**Details:**
Created `sentinel init wizard` interactive command for first-time setup. Implemented profile discovery from ~/.aws/config using vault.LoadConfigFromEnv(). Built step-by-step wizard flow: Welcome -> Profiles -> Features -> Region -> Output Options -> Summary. Added non-interactive mode with --profile/--feature/--format flags for scripting.

### Phase 65: Error Enhancement

**Goal**: Better error messages for permission failures with specific fix suggestions
**Depends on**: Phase 64
**Plans**: 2 plans

Plans:
- [x] 65-01: Structured error types and AWS error classifiers
- [x] 65-02: CLI integration with error enhancement

**Details:**
Created SentinelError interface with Code(), Suggestion(), Context() for structured error handling. Defined 17 error codes covering SSM, DynamoDB, IAM, Policy, and Config errors. Implemented AWS error classifiers (WrapSSMError, WrapDynamoDBError, WrapIAMError). Integrated errors into policy loader, CLI commands, DynamoDB stores, and permissions checker.

### Phase 66: Config Validation

**Goal**: `sentinel config validate` to catch misconfigurations before runtime
**Depends on**: Phase 65
**Plans**: 1 plan

Plans:
- [x] 66-01: Validation types, validators, CLI command

**Details:**
Created config package with validation types and registry. Implemented validators for all 5 config types with semantic checks. Added warnings for suspicious patterns (empty profiles, short cooldowns). Built CLI command with file and SSM path support. Auto-detects config type from YAML structure.

### Phase 67: Quick Start Templates

**Goal**: Pre-built configs for common use cases (`--template basic|approvals|full`)
**Depends on**: Phase 66
**Plans**: 1 plan

Plans:
- [x] 67-01: Template types, generators, CLI command

**Details:**
Created TemplateID type with basic, approvals, full values and registry. Implemented GenerateTemplate function producing valid YAML for all config types. Added `sentinel config generate --template X --profile Y` CLI command. All generated configs pass validation.

### Phase 68: Onboarding Docs

**Goal**: QUICKSTART.md, updated BOOTSTRAP.md, permission matrix documentation
**Depends on**: Phase 67
**Plans**: 1 plan

Plans:
- [x] 68-01: Onboarding documentation (QUICKSTART.md, PERMISSIONS.md, commands.md)

**Details:**
Created QUICKSTART.md with 5-minute setup path. Created PERMISSIONS.md with complete permission matrix for all 10 features. Updated commands.md with permissions, permissions check, config validate, config generate, and init wizard commands.

---

## Milestone Summary

**Key Decisions:**
- Permission schema uses string type aliases with IsValid methods for enums
- 8 subsystems and 10 features covering all Sentinel capabilities
- Terraform format uses aws_iam_policy_document data source (most common pattern)
- Always-detected features: credential_issue, audit_verify, enforce_analyze
- DynamoDB detection checks sentinel-requests and sentinel-breakglass tables
- Renamed check subcommand flags to avoid kingpin inheritance conflict
- Wizard as subcommand due to kingpin parent command limitations
- SentinelError interface with Unwrap() for standard error chain compatibility
- Warnings don't affect exit code - valid with warnings returns 0
- No explicit default-deny rule needed in templates

**Issues Resolved:**
- Permission discovery from trial-and-error to self-service via `sentinel permissions`
- IAM policy creation friction eliminated with Terraform/CloudFormation output
- Permission validation now automated via `sentinel permissions check`
- Onboarding time reduced with `sentinel init wizard` guided setup
- Error messages now include actionable fix suggestions
- Configuration validation before runtime via `sentinel config validate`
- Quick start from zero to working config via templates

**Issues Deferred:**
None

**Technical Debt Incurred:**
None

---

_For current project status, see .planning/ROADMAP.md_
