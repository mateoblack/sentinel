# Milestone v1.16: Security Hardening

**Status:** ✅ SHIPPED 2026-01-26
**Phases:** 113-120
**Total Plans:** 9

## Overview

Comprehensive security hardening addressing audit findings with timing attack mitigation, secrets management, CI/CD security scanning, DynamoDB encryption, API rate limiting, error sanitization, and security validation tests.

## Phases

### Phase 113: Timing Attack Remediation

**Goal**: Fix bearer token comparison vulnerability using crypto/subtle.ConstantTimeCompare()
**Depends on**: v1.15 complete
**Plans**: 1 plan

Plans:
- [x] 113-01: Fix timing attack in withAuthorizationCheck functions — completed 2026-01-25

**Details:**
- Replaced direct string comparison with crypto/subtle.ConstantTimeCompare in ECS and Sentinel servers
- Added security comments explaining vulnerability and mitigation
- Created security regression tests with AST verification

### Phase 114: Secrets Manager Migration

**Goal**: Move MDM API token from environment variable to AWS Secrets Manager
**Depends on**: Phase 113
**Plans**: 2 plans

Plans:
- [x] 114-01: Secrets Manager caching client and config integration — completed 2026-01-25
- [x] 114-02: Terraform module and documentation updates — completed 2026-01-25

**Details:**
- SecretsLoader interface with CachedSecretsLoader implementation
- 1-hour cache TTL optimized for Lambda cold start patterns
- Backward compatible env var fallback with deprecation warnings

### Phase 115: CI/CD Security Scanning

**Goal**: Add govulncheck, gosec, and Trivy to GitHub Actions for SAST and dependency scanning
**Depends on**: Phase 113
**Plans**: 1 plan

Plans:
- [x] 115-01: Fix and enhance gosec and Trivy workflows — completed 2026-01-25

**Details:**
- Fixed gosec workflow with SARIF output for GitHub Security tab
- Replaced broken Trivy Docker workflow with filesystem dependency scan
- Pinned action versions for reproducible builds
- Consistent weekly schedule (Monday 9am UTC)

### Phase 116: DynamoDB Encryption

**Goal**: Add explicit KMS encryption in Terraform for all DynamoDB tables
**Depends on**: Phase 115
**Plans**: 1 plan

Plans:
- [x] 116-01: Enable KMS encryption for all Sentinel DynamoDB tables — completed 2026-01-25

**Details:**
- Added EncryptionType constants and EncryptionConfig struct
- SSESpecification mapping in provisioner
- AWS managed KMS as default (simpler than customer CMK)
- All three Sentinel tables default to KMS encryption

### Phase 117: API Rate Limiting

**Goal**: Implement rate limiting for Lambda TVM and credential server endpoints
**Depends on**: Phase 116
**Plans**: 2 plans

Plans:
- [x] 117-01: Rate limiter types and Lambda TVM integration — completed 2026-01-25
- [x] 117-02: Credential server rate limiting and security tests — completed 2026-01-25

**Details:**
- Created ratelimit package with sliding window log algorithm
- Rate limit by IAM user ARN (Lambda) or remote address (credential server)
- Default 100 requests per 60 seconds
- Fail-open on rate limiter errors (availability preferred)
- RFC 7231 compliant Retry-After header on 429 responses

### Phase 118: Dependency Security Audit

**Goal**: Audit all Go dependencies, update vulnerable packages, document security posture
**Depends on**: Phase 117
**Plans**: 1 plan

Plans:
- [x] 118-01: Dependency audit and security documentation — completed 2026-01-25

**Details:**
- Audited all Go dependencies against vulnerability database
- Verified golang.org/x/crypto at v0.47.0 is patched
- Updated SECURITY.md with dependency posture
- Documented CI security scanning workflows

### Phase 119: Error Sanitization

**Goal**: Review and sanitize error messages to prevent information leakage
**Depends on**: Phase 118
**Plans**: 1 plan

Plans:
- [x] 119-01: Sanitize error responses across Lambda TVM, Sentinel, EC2/ECS servers — completed 2026-01-26

**Details:**
- Sanitized 14 error paths across 4 files
- Pattern: log.Printf details internally, return generic message to client
- Preserved rate limit and policy deny messages (intentional user-facing)
- Consistent ERROR: prefix for internal error logs

### Phase 120: Security Validation

**Goal**: Integration tests for all security fixes and updated security documentation
**Depends on**: Phase 119
**Plans**: 1 plan

Plans:
- [x] 120-01: Security integration tests and SECURITY.md update — completed 2026-01-26

**Details:**
- Lambda TVM security integration tests (error sanitization, rate limiting, AST verification)
- Sentinel server security integration tests (concurrent rate limiting, Retry-After, end-to-end)
- SECURITY.md updated with comprehensive v1.16 hardening section

---

## Milestone Summary

**Key Decisions:**
- crypto/subtle.ConstantTimeCompare for timing attack mitigation
- AWS managed KMS (not customer CMK) for simpler key management
- Sliding window algorithm over token bucket for rate limiting
- Rate limit by IAM ARN, not IP (IAM auth identifies caller)
- Fail-open on rate limiter errors (availability over blocking)
- Error sanitization: log details, return generic messages
- 1-hour cache TTL for Secrets Manager (Lambda cold start optimization)

**Issues Resolved:**
- Timing attack vulnerability in bearer token comparison
- MDM API token exposed in environment variables
- No automated security scanning in CI/CD
- DynamoDB tables using default AWS owned encryption
- No rate limiting on credential endpoints
- Internal error details leaked in API responses

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
