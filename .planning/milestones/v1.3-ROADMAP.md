# Milestone v1.3: Break-Glass

**Status:** SHIPPED 2026-01-16
**Phases:** 27-34
**Total Plans:** 15

## Overview

Emergency access bypass with enhanced audit, time-bounded sessions, and immediate security notifications. Allows authorized users to invoke break-glass access when policy denies, with mandatory justification, rate limiting, and comprehensive audit trail.

## Phases

### Phase 27: Break-Glass Schema

**Goal**: Define emergency access model with reason codes, expiry, and validation
**Depends on**: v1.2 complete
**Plans**: 1 plan

Plans:
- [x] 27-01: Break-glass types with state machine and validation — completed 2026-01-15

**Details:**
- BreakGlassEvent struct with active/closed/expired state machine
- ReasonCode enum: incident, maintenance, security, recovery, other
- 4-hour max TTL, 20-char minimum justification
- NewBreakGlassID() and Validate() methods

### Phase 28: Break-Glass Command

**Goal**: CLI command to invoke emergency access with mandatory justification
**Depends on**: Phase 27
**Plans**: 2 plans

Plans:
- [x] 28-01: Break-glass storage layer with Store interface and DynamoDB — completed 2026-01-15
- [x] 28-02: Break-glass CLI command — completed 2026-01-15

**Details:**
- Store interface following request package pattern
- DynamoDB implementation with GSIs: gsi-invoker, gsi-status, gsi-profile
- FindActiveByInvokerAndProfile for access stacking prevention
- CLI command with JSON output including event_id, profile, reason_code

### Phase 29: Elevated Audit

**Goal**: Enhanced logging with mandatory justification and incident correlation
**Depends on**: Phase 28
**Plans**: 2 plans

Plans:
- [x] 29-01: Break-glass audit logging infrastructure — completed 2026-01-15
- [x] 29-02: CLI break-glass logging integration — completed 2026-01-15

**Details:**
- BreakGlassLogEntry type with all audit fields
- Event type constants: breakglass.invoked, breakglass.closed, breakglass.expired
- Logger.LogBreakGlass method on Logger interface
- Nil-safe Logger check pattern for optional logging

### Phase 30: Time-Bounded Sessions

**Goal**: Automatic credential expiry and renewal limits for break-glass access
**Depends on**: Phase 29
**Plans**: 2 plans

Plans:
- [x] 30-01: Break-glass checker function with FindActiveBreakGlass — completed 2026-01-15
- [x] 30-02: Break-glass credential integration with duration capping — completed 2026-01-15

**Details:**
- FindActiveBreakGlass checker following request/checker.go pattern
- RemainingDuration helper for expiry tracking
- Override chain: policy -> approved request -> break-glass
- Automatic session duration capping to remaining break-glass time
- BreakGlassEventID in decision logs for CloudTrail correlation

### Phase 31: Notification Blast

**Goal**: Immediate alerts to security team on break-glass invocation
**Depends on**: Phase 30
**Plans**: 2 plans

Plans:
- [x] 31-01: Break-glass notification types and BreakGlassEvent struct — completed 2026-01-15
- [x] 31-02: BreakGlassNotifier interface and CLI integration — completed 2026-01-15

**Details:**
- BreakGlassEventType constants: breakglass.invoked, breakglass.closed, breakglass.expired
- BreakGlassNotifier interface with SNS, Webhook, Multi, Noop implementations
- Best-effort notifications (errors logged but don't fail command)
- Notification fires after successful store and logging

### Phase 32: Post-Incident Review

**Goal**: Commands to list, review, and close break-glass events
**Depends on**: Phase 31
**Plans**: 2 plans

Plans:
- [x] 32-01: breakglass-list and breakglass-check commands — completed 2026-01-15
- [x] 32-02: breakglass-close command with notifications/logging — completed 2026-01-15

**Details:**
- breakglass-list command with filter support for invoker, status, profile
- breakglass-check command with full event detail output
- breakglass-close command with state machine validation
- All four break-glass commands registered in sentinel CLI

### Phase 33: Rate Limiting

**Goal**: Prevent break-glass abuse with cooldowns, quotas, and escalation
**Depends on**: Phase 32
**Plans**: 2 plans

Plans:
- [x] 33-01: Rate limit types, validation, and Store count methods — completed 2026-01-15
- [x] 33-02: Rate limit checker and CLI integration — completed 2026-01-15

**Details:**
- RateLimitPolicy and RateLimitRule types with validation
- Cooldown, MaxPerUser, MaxPerProfile, QuotaWindow, EscalationThreshold fields
- CountByInvokerSince, CountByProfileSince, GetLastByInvokerAndProfile store methods
- CheckRateLimit function with RateLimitResult struct
- Check order: cooldown -> user quota -> profile quota -> escalation flag

### Phase 34: Break-Glass Policies

**Goal**: Policy rules for who can invoke break-glass and under what conditions
**Depends on**: Phase 33
**Plans**: 2 plans

Plans:
- [x] 34-01: Break-glass policy types with validation and matching — completed 2026-01-16
- [x] 34-02: CLI break-glass policy integration — completed 2026-01-16

**Details:**
- BreakGlassPolicy and BreakGlassPolicyRule types following ApprovalPolicy patterns
- AllowedUsers, AllowedReasonCodes, TimeWindow, MaxDuration constraints
- FindBreakGlassPolicyRule, CanInvokeBreakGlass, IsBreakGlassAllowed functions
- Empty lists = wildcards (all allowed)
- Policy check after profile validation, before rate limit check

---

## Milestone Summary

**Key Decisions:**
- Break-glass state machine: active -> closed/expired (no pending - immediate access)
- 4-hour max TTL for break-glass (shorter than approval requests)
- Five reason codes for incident categorization
- Access stacking prevention via FindActiveByInvokerAndProfile
- Best-effort notifications (don't fail command on notification error)
- Rate limit check order: cooldown -> user quota -> profile quota -> escalation
- Escalation threshold flags for notification only, doesn't block
- Empty lists = wildcards for AllowedReasonCodes, Profiles

**Issues Resolved:**
- None - clean implementation

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- matchesTimeWindow helper duplicated from policy package (not exported)

---

_For current project status, see .planning/ROADMAP.md_
