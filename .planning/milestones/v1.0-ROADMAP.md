# Milestone v1.0: MVP

**Status:** SHIPPED 2026-01-14
**Phases:** 1-8
**Total Plans:** 16

## Overview

Sentinel adds intent-aware access control to aws-vault, evaluating policy rules before issuing AWS credentials. The journey starts with CLI foundation and aws-vault integration, moves through policy schema design and SSM-based loading, implements the core decision engine, then exposes this through credential_process and exec commands with full logging and profile compatibility.

## Phases

### Phase 1: Foundation
**Goal:** CLI scaffolding with kingpin, project structure, and aws-vault library integration
**Depends on:** Nothing (first phase)
**Plans:** 2 plans

Plans:
- [x] 01-01: CLI skeleton with kingpin, main entry point
- [x] 01-02: aws-vault library integration, credential provider access

**Details:**
- Created Sentinel CLI entry point at cmd/sentinel/main.go
- Defined Sentinel struct with keyring and AWS config accessors
- Implemented ConfigureSentinelGlobals with all backend flags
- GetCredentials method integrating with vault.NewTempCredentialsProvider

### Phase 2: Policy Schema
**Goal:** Define YAML/JSON policy format with rules for user, profile, time, and conditions
**Depends on:** Phase 1
**Plans:** 2 plans

Plans:
- [x] 02-01: Policy schema design and Go structs
- [x] 02-02: Policy parsing and validation

**Details:**
- Policy, Rule, Condition, TimeWindow, HourRange types with YAML/JSON tags
- Effect and Weekday type aliases with IsValid() validation methods
- ParsePolicy() and ParsePolicyFromReader() for loading YAML policies
- 30 comprehensive table-driven tests covering all error conditions

### Phase 3: Policy Loading
**Goal:** Fetch policies from SSM Parameter Store with caching
**Depends on:** Phase 2
**Plans:** 2 plans

Plans:
- [x] 03-01: SSM client setup and parameter fetch
- [x] 03-02: Policy caching with TTL

**Details:**
- Loader struct with SSM client for fetching policies from Parameter Store
- ErrPolicyNotFound sentinel error with parameter name context
- CachedLoader with TTL-based caching (5-minute default)
- sync.RWMutex for concurrent cache access

### Phase 4: Policy Evaluation
**Goal:** Core decision engine that evaluates rules and returns allow/deny with matched rule
**Depends on:** Phase 3
**Plans:** 2 plans

Plans:
- [x] 04-01: Rule matching engine
- [x] 04-02: Decision result with matched rule context

**Details:**
- Evaluate() function with first-match-wins semantics
- Request struct captures User, Profile, and Time
- Decision struct returns Effect, MatchedRule name, and Reason
- Time window matching with timezone conversion
- Default deny on no match or nil input

### Phase 5: Credential Process
**Goal:** `sentinel credentials --profile X` command with AWS credential_process JSON output
**Depends on:** Phase 4
**Plans:** 2 plans

Plans:
- [x] 05-01: credentials command with policy evaluation
- [x] 05-02: credential_process JSON output format

**Details:**
- credentials command with --profile and --policy-parameter flags
- Policy evaluation gates credential retrieval
- credential_process JSON output on ALLOW with Version, AccessKeyId, SecretAccessKey, SessionToken, Expiration

### Phase 6: Decision Logging
**Goal:** Structured logging of every access decision (user, profile, allow/deny, rule matched)
**Depends on:** Phase 5
**Plans:** 2 plans

Plans:
- [x] 06-01: Structured logger with decision fields
- [x] 06-02: Log destination configuration

**Details:**
- Logger interface with JSONLogger and NopLogger implementations
- DecisionLogEntry struct with timestamp, user, profile, effect, rule, reason
- JSON Lines format for log aggregation compatibility
- --log-file and --log-stderr flags for configurable destinations

### Phase 7: Exec Command
**Goal:** `sentinel exec --profile X -- cmd` for direct command invocation with credentials
**Depends on:** Phase 5
**Plans:** 2 plans

Plans:
- [x] 07-01: exec command with subprocess spawning
- [x] 07-02: Environment variable injection

**Details:**
- exec command with positional args following aws-vault pattern
- SentinelExecCommand returns (int, error) for exit code propagation
- Environment variable injection with AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_SESSION_TOKEN
- Reuses exec.go helpers (getDefaultShell, createEnv)

### Phase 8: Profile Compatibility
**Goal:** Work transparently with existing ~/.aws/config profiles without modification
**Depends on:** Phase 7
**Plans:** 2 plans

Plans:
- [x] 08-01: AWS config file parsing integration
- [x] 08-02: Profile validation and error handling

**Details:**
- ValidateProfile method on Sentinel struct
- Fail-fast validation before policy loading
- Error messages include list of available profiles for user guidance
- Profile validation integrated into both credentials and exec commands

---

## Milestone Summary

**Key Decisions:**
- Use kingpin (not cobra) to match existing aws-vault patterns
- Share aws-vault keyring service name for credential store access
- Follow vault.NewTempCredentialsProvider pattern from exec.go
- String type aliases for Effect/Weekday with validation methods
- Regex-based hour format validation (HH:MM 24-hour)
- Caller provides aws.Config to Loader (no hidden config loading)
- sync.RWMutex for cache (better read performance)
- Hour range [start, end) semantics (inclusive start, exclusive end)
- Empty list = wildcard matching
- Default deny on no match/nil input
- JSON Lines format for log aggregation compatibility
- OS username for policy evaluation
- 5-minute cache TTL for policy loading
- SentinelExecCommand returns (int, error) for exit code propagation
- Fail-fast profile validation with helpful error messages

**Issues Resolved:**
- None - clean implementation

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None identified

---

_For current project status, see .planning/ROADMAP.md_
